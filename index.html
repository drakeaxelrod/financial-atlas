<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Financial Atlas – Your Financial Independence & Retirement Planner</title>
  <meta name="description" content="FIRE calculator, compound interest tools, lazy portfolio strategies, and market guidance—all in a single-page financial planning app." />
  <meta name="keywords" content="FIRE calculator, financial independence, retirement planner, compound interest, lazy portfolio, personal finance, investing" />
  <meta name="author" content="Drake Axelrod" />

  <!-- Favicon using FontAwesome calculator icon -->
  <link rel="icon" href="https://raw.githubusercontent.com/drakeaxelrod/financial-atlas/refs/heads/main/piggybank.svg" type="image/svg+xml" />


    <!-- Essential CDNs Only -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/framer-motion@11.0.0/dist/framer-motion.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/money.js/0.2.0/money.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/14.5.3/math.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #1e40af;
            --primary-light: #3b82f6;
            --primary-dark: #1e3a8a;
            --secondary: #64748b;
            --secondary-light: #94a3b8;
            --accent: #f59e0b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --surface: #ffffff;
            --surface-secondary: #f8fafc;
            --border: #e2e8f0;
            --text: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --radius: 0.75rem;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: var(--text);
            line-height: 1.6;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .card {
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            text-decoration: none;
            outline: none;
            min-height: 2.75rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(30, 64, 175, 0.4);
        }

        .btn-secondary {
            background: var(--surface);
            color: var(--text);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--surface-secondary);
            border-color: var(--secondary);
            transform: translateY(-1px);
        }

        .input-field {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            background: var(--surface);
            color: var(--text);
            font-size: 0.875rem;
            transition: all 0.3s ease;
            outline: none;
        }

        .input-field:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        .input-field::placeholder {
            color: var(--text-muted);
        }

        .tabs {
            display: flex;
            background: var(--surface);
            border-radius: var(--radius);
            padding: 0.25rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            margin-bottom: 2rem;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .tabs::-webkit-scrollbar {
            display: none;
        }

        .tab {
            flex: 1;
            min-width: max-content;
            padding: 0.75rem 1rem;
            text-align: center;
            border-radius: calc(var(--radius) - 0.25rem);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.875rem;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 2px 8px rgba(30, 64, 175, 0.3);
        }

        .tab:hover:not(.active) {
            background: var(--surface-secondary);
            color: var(--text);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.25rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 1.25rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem;
            margin-bottom: 0.75rem;
        }

        .stat-value {
            font-size: 1.625rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 0.125rem;
            line-height: 1.1;
        }

        .stat-label {
            font-size: 0.8125rem;
            color: var(--text-secondary);
            font-weight: 500;
            line-height: 1.2;
        }

        .chart-container {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 1.25rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            margin-bottom: 1.5rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.25rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .form-label {
            font-weight: 600;
            color: var(--text);
            font-size: 0.8125rem;
            line-height: 1.2;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .card {
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-1px);
        }

        /* Optimized market data cards */
        .market-card {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 1rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .market-card:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .market-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        /* Compact ticker */
        .ticker-container {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            color: white;
            padding: 0.75rem 0;
            overflow: hidden;
            position: relative;
            border-bottom: 1px solid var(--border);
        }

        .ticker-content {
            display: flex;
            animation: scroll-left 45s linear infinite;
            gap: 2rem;
            white-space: nowrap;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .ticker-item {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0 1rem;
            flex-shrink: 0;
        }

        /* Responsive optimizations */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 1rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .market-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .container {
                padding: 0 0.75rem;
            }

            .stat-card {
                padding: 1rem;
            }

            .chart-container {
                padding: 1rem;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-wrap: wrap;
                gap: 0.25rem;
            }

            .tab {
                font-size: 0.8125rem;
                padding: 0.625rem 0.75rem;
            }
        }

        .stat-icon {
            width: 3rem;
            height: 3rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .chart-container {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-weight: 600;
            color: var(--text);
            font-size: 0.875rem;
        }

        .progress-bar {
            width: 100%;
            height: 0.5rem;
            background: var(--border);
            border-radius: 0.25rem;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--success) 100%);
            transition: width 1s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Loading and animation states */
        .loading-spinner {
            width: 2rem;
            height: 2rem;
            border: 2px solid var(--border);
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Ticker animation */
        @keyframes scroll-left {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }

        /* Compact layout helpers */
        .compact-layout {
            padding: 0.75rem;
        }

        .compact-layout .stats-grid {
            gap: 0.75rem;
        }

        .compact-layout .stat-card {
            padding: 1rem;
        }

        .compact-layout .chart-container {
            padding: 1rem;
        }

        /* Market data specific styles */
        .market-status {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            background: var(--surface-secondary);
            color: var(--text-secondary);
        }

        .market-status.open {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }

        .market-status.closed {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .market-status.pre-market {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
        }

        /* Improved tooltips */
        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip .tooltip-content {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text);
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            white-space: nowrap;
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            pointer-events: none;
        }

        .tooltip:hover .tooltip-content {
            opacity: 1;
            visibility: visible;
        }

        /* Mini chart styles */
        .chart-mini {
            height: 40px;
            width: 100%;
            opacity: 0.8;
            transition: opacity 0.2s ease;
        }

        .market-card:hover .chart-mini {
            opacity: 1;
        }

        /* Search box optimization */
        .search-box {
            position: relative;
            margin-bottom: 1rem;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            background: var(--surface);
            color: var(--text);
            font-size: 0.875rem;
            transition: all 0.3s ease;
            outline: none;
        }

        .search-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            z-index: 1;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--surface);
            border: 1px solid var(--border);
            border-top: none;
            border-radius: 0 0 var(--radius) var(--radius);
            box-shadow: var(--shadow);
            z-index: 10;
            max-height: 300px;
            overflow-y: auto;
        }

        .search-result {
            padding: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border-bottom: 1px solid var(--border);
        }

        .search-result:hover {
            background: var(--surface-secondary);
        }

        .search-result:last-child {
            border-bottom: none;
        }

        .pulse-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ef4444;
            position: relative;
            animation: pulse-dot 2s infinite;
        }

        .pulse-dot::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: #ef4444;
            animation: pulse-ring 2s infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes pulse-ring {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(2.5); opacity: 0; }
        }

        .number-counter {
            font-feature-settings: "tnum";
            font-variant-numeric: tabular-nums;
        }

        .market-heat-map {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 4px;
            margin: 1rem 0;
        }

        .heat-cell {
            aspect-ratio: 1;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .heat-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .heat-positive-weak { background: #dcfce7; color: #166534; }
        .heat-positive-medium { background: #bbf7d0; color: #14532d; }
        .heat-positive-strong { background: #16a34a; color: white; }
        .heat-negative-weak { background: #fee2e2; color: #991b1b; }
        .heat-negative-medium { background: #fecaca; color: #7f1d1d; }
        .heat-negative-strong { background: #dc2626; color: white; }
        .heat-neutral { background: #f3f4f6; color: #374151; }

        .ticker-performance {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }

        .ticker-performance:hover {
            background: rgba(0,0,0,0.05);
        }

        .performance-bar {
            height: 4px;
            border-radius: 2px;
            transition: width 0.5s ease;
        }

        .performance-positive { background: #10b981; }
        .performance-negative { background: #ef4444; }

        /* Enhanced stock cards */
        .stock-card-advanced {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stock-card-advanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .stock-card-advanced:hover::before {
            transform: scaleX(1);
        }

        .stock-card-advanced:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .metric-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .metric-badge.positive {
            background: #ecfdf5;
            color: #065f46;
        }

        .metric-badge.negative {
            background: #fef2f2;
            color: #991b1b;
        }

        .metric-badge.neutral {
            background: #f8fafc;
            color: #475569;
        }

        /* Loading states */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-text {
            height: 1em;
            border-radius: 0.25rem;
            margin: 0.25rem 0;
        }

        .skeleton-button {
            height: 2.5rem;
            border-radius: 0.5rem;
            width: 100%;
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 1px solid #e5e7eb;
            padding: 16px;
            max-width: 400px;
            z-index: 1000;
            animation: slideInRight 0.3s ease-out;
        }

        .toast.success {
            border-left: 4px solid #10b981;
        }

        .toast.error {
            border-left: 4px solid #ef4444;
        }

        .toast.info {
            border-left: 4px solid #3b82f6;
        }

        .toast.warning {
            border-left: 4px solid #f59e0b;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-exit {
            animation: slideOutRight 0.3s ease-in;
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Responsive improvements */
        @media (max-width: 768px) {
            .market-heat-map {
                grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            }

            .heat-cell {
                font-size: 0.625rem;
            }

            .stock-card-advanced {
                padding: 1rem;
            }

            .toast {
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }

        .loading-spinner {
            display: inline-block;
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: currentColor;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in {
            animation: slideIn 0.8s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .pulse-subtle {
            animation: pulseSubtle 2.5s ease-in-out infinite;
        }

        @keyframes pulseSubtle {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.02); opacity: 0.95; }
        }

        .shimmer {
            position: relative;
            overflow: hidden;
        }

        .shimmer::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .card-hover-lift:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .gradient-border {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            padding: 2px;
            border-radius: calc(var(--radius) + 2px);
        }

        .gradient-border > div {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 1.5rem;
        }

        /* Market Ticker Styles */
        .ticker-container {
            overflow: hidden;
            white-space: nowrap;
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: white;
            padding: 0.5rem 0;
            position: relative;
        }

        .ticker-content {
            display: inline-block;
            animation: scroll-ticker 60s linear infinite;
            padding-left: 100%;
        }

        @keyframes scroll-ticker {
            0% { transform: translate3d(0, 0, 0); }
            100% { transform: translate3d(-100%, 0, 0); }
        }

        .ticker-item {
            display: inline-block;
            margin-right: 3rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .market-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .stock-card {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: box-shadow 0.3s ease, transform 0.3s ease;
            position: relative;
            overflow: hidden;
            opacity: 1;
            transform: translateY(0);
        }

        .stock-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .stock-card.positive {
            border-left: 4px solid var(--success);
        }

        .stock-card.negative {
            border-left: 4px solid var(--danger);
        }

        .stock-card.loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .price-positive {
            color: var(--success);
        }

        .price-negative {
            color: var(--danger);
        }

        .chart-mini {
            width: 100%;
            height: 60px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1));
            border-radius: 0.5rem;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .chart-mini canvas {
            width: 100% !important;
            height: 100% !important;
        }

        /* Search Box Styles */
        .search-box {
            position: relative;
            max-width: 300px;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 0.875rem;
            transition: all 0.3s ease;
            background: white;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            max-height: 200px;
            overflow-y: auto;
            z-index: 50;
            margin-top: 0.25rem;
        }

        .search-result {
            padding: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid var(--border);
        }

        .search-result:hover {
            background: var(--surface-secondary);
        }

        .search-result:last-child {
            border-bottom: none;
        }

        /* Heat Map Styles */
        .market-heat-map {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .heat-cell {
            padding: 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .heat-cell:hover {
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .heat-positive-strong { background: #10b981; color: white; }
        .heat-positive-medium { background: #34d399; color: white; }
        .heat-positive-weak { background: #a7f3d0; color: #065f46; }
        .heat-negative-strong { background: #ef4444; color: white; }
        .heat-negative-medium { background: #f87171; color: white; }
        .heat-negative-weak { background: #fecaca; color: #991b1b; }
        .heat-neutral { background: #e5e7eb; color: #374151; }

        .text-primary { color: var(--primary); }
        .text-secondary { color: var(--text-secondary); }
        .text-success { color: var(--success); }
        .text-warning { color: var(--warning); }
        .text-danger { color: var(--danger); }

        .bg-primary { background: var(--primary); }
        .bg-secondary { background: var(--secondary); }
        .bg-success { background: var(--success); }
        .bg-warning { background: var(--warning); }
        .bg-danger { background: var(--danger); }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 0 0.5rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .tabs {
                flex-direction: column;
                gap: 0.25rem;
            }

            .tab {
                text-align: left;
            }
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Enhanced Tooltip System */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip-content {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            white-space: nowrap;
            max-width: 300px;
            white-space: normal;
            text-align: center;
            z-index: 1000;
            margin-bottom: 0.5rem;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .tooltip-content::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 4px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
        }

        .tooltip:hover .tooltip-content {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-4px);
        }

        /* Tab tooltips */
        .tab {
            position: relative;
        }

        .tab .tooltip-content {
            bottom: auto;
            top: 100%;
            margin-top: 0.5rem;
            margin-bottom: 0;
        }

        .tab .tooltip-content::after {
            top: auto;
            bottom: 100%;
            border-top-color: transparent;
            border-bottom-color: rgba(0, 0, 0, 0.9);
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            white-space: nowrap;
            z-index: 1000;
            animation: tooltip-appear 0.2s ease-out;
            max-width: 300px;
            white-space: normal;
        }

        .tooltip:hover::before {
            content: '';
            position: absolute;
            bottom: 120%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
        }

        @keyframes tooltip-appear {
            from { opacity: 0; transform: translateX(-50%) translateY(5px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        /* Search Box Styles */
        .search-box {
            position: relative;
            width: 100%;
            max-width: 400px;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 48px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--surface);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            pointer-events: none;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            margin-top: 4px;
        }

        .search-result {
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid var(--border);
        }

        .search-result:hover {
            background: var(--surface-secondary);
        }

        .search-result:last-child {
            border-bottom: none;
        }

        /* Mini Chart Styles */
        .mini-chart {
            height: 40px;
            width: 100%;
            margin: 8px 0;
            position: relative;
            background: linear-gradient(to right, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%);
            border-radius: 4px;
            overflow: hidden;
        }

        .mini-chart svg {
            width: 100%;
            height: 100%;
        }

        .mini-chart .chart-line {
            fill: none;
            stroke: var(--primary);
            stroke-width: 2;
            opacity: 0.8;
        }

        .mini-chart .chart-area {
            fill: url(#chartGradient);
            opacity: 0.3;
        }

        /* Stable Market Data Container */
        .market-data-container {
            opacity: 1;
        }

        .market-data-container.loaded {
            opacity: 1;
        }

        /* Enhanced Stock Cards */
        .stock-card.enhanced {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .stock-card.enhanced:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stock-card.enhanced.positive {
            border-left: 4px solid var(--success);
        }

        .stock-card.enhanced.negative {
            border-left: 4px solid var(--danger);
        }

        .stock-card.enhanced.neutral {
            border-left: 4px solid var(--secondary);
        }

        /* Stable price animations */
        .price-change {
            transition: all 0.3s ease;
            position: relative;
        }

        .price-change.flash-green {
            animation: flash-green 0.5s ease-out;
        }

        .price-change.flash-red {
            animation: flash-red 0.5s ease-out;
        }

        @keyframes flash-green {
            0% { background-color: transparent; }
            50% { background-color: rgba(16, 185, 129, 0.2); }
            100% { background-color: transparent; }
        }

        @keyframes flash-red {
            0% { background-color: transparent; }
            50% { background-color: rgba(239, 68, 68, 0.2); }
            100% { background-color: transparent; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback, useRef, createContext, useContext } = React;

        // Configuration Management
        const DEFAULT_CONFIG = {
            currentAge: 30,
            retirementAge: 65,
            currentSavings: 50000,
            monthlySavings: 2000,
            annualReturn: 7,
            monthlyExpenses: 4000,
            safeWithdrawalRate: 4,
            inflationRate: 2.5,
            currency: 'USD',
            volatility: 15,
            numSimulations: 1000,
        };

        // Currency Setup
        const SUPPORTED_CURRENCIES = [
            { value: 'USD', label: '🇺🇸 US Dollar (USD)', symbol: '$' },
            { value: 'EUR', label: '🇪🇺 Euro (EUR)', symbol: '€' },
            { value: 'GBP', label: '🇬🇧 British Pound (GBP)', symbol: '£' },
            { value: 'CAD', label: '🇨🇦 Canadian Dollar (CAD)', symbol: 'C$' },
            { value: 'AUD', label: '🇦🇺 Australian Dollar (AUD)', symbol: 'A$' },
            { value: 'SEK', label: '🇸🇪 Swedish Krona (SEK)', symbol: 'kr' },
            { value: 'NOK', label: '🇳🇴 Norwegian Krone (NOK)', symbol: 'kr' },
            { value: 'DKK', label: '🇩🇰 Danish Krone (DKK)', symbol: 'kr' },
            { value: 'CHF', label: '🇨🇭 Swiss Franc (CHF)', symbol: 'CHF' },
            { value: 'JPY', label: '🇯🇵 Japanese Yen (JPY)', symbol: '¥' }
        ];

        // Currency API and conversion setup
        const setupCurrencyAPI = async () => {
            if (window.fx) {
                fx.base = "USD";
                try {
                    // Try to fetch live rates from fxratesapi.com (free API)
                    const response = await fetch('https://api.fxratesapi.com/latest?base=USD');
                    const data = await response.json();
                    fx.rates = data.rates;
                    fx.rates.USD = 1; // Ensure USD base is set
                } catch (error) {
                    console.warn('Failed to fetch live exchange rates, using fallback rates');
                    // Fallback static rates
                    fx.rates = {
                        'USD': 1,
                        'EUR': 0.85,
                        'GBP': 0.73,
                        'CAD': 1.35,
                        'AUD': 1.50,
                        'SEK': 10.50,
                        'NOK': 10.80,
                        'DKK': 6.35,
                        'CHF': 0.88,
                        'JPY': 110.0
                    };
                }
            }
        };

        // Session analytics and user statistics
        const getSessionAnalytics = () => {
            try {
                const sessionData = JSON.parse(localStorage.getItem('sessionData') || '{}');
                const totalSessions = parseInt(localStorage.getItem('totalSessions') || '0');
                const calculatorData = JSON.parse(localStorage.getItem('calculatorData') || '{}');

                return {
                    totalSessions,
                    lastVisit: sessionData.lastVisit || new Date().toISOString(),
                    preferredCurrency: sessionData.preferredCurrency || 'USD',
                    lastActiveTab: sessionData.lastActiveTab || 'calculator',
                    marketDataUpdates: marketDataCache.metadata.totalUpdates || 0,
                    calculatorUsage: {
                        lastCalculation: calculatorData.lastCalculation || null,
                        totalCalculations: calculatorData.totalCalculations || 0
                    }
                };
            } catch (error) {
                console.warn('Failed to load session analytics:', error);
                return {
                    totalSessions: 0,
                    lastVisit: new Date().toISOString(),
                    preferredCurrency: 'USD',
                    lastActiveTab: 'calculator',
                    marketDataUpdates: 0,
                    calculatorUsage: { lastCalculation: null, totalCalculations: 0 }
                };
            }
        };

        // Save user preferences and usage patterns
        const saveUserPreferences = (preferences) => {
            try {
                const existing = JSON.parse(localStorage.getItem('userPreferences') || '{}');
                const updated = { ...existing, ...preferences, lastUpdated: new Date().toISOString() };
                localStorage.setItem('userPreferences', JSON.stringify(updated));
                localStorage.setItem('preferredCurrency', preferences.currency || 'USD');
            } catch (error) {
                console.warn('Failed to save user preferences:', error);
            }
        };

        // Track calculator usage
        const trackCalculatorUsage = (calculationType, result) => {
            try {
                const existing = JSON.parse(localStorage.getItem('calculatorData') || '{}');
                const updated = {
                    ...existing,
                    lastCalculation: new Date().toISOString(),
                    totalCalculations: (existing.totalCalculations || 0) + 1,
                    calculationType,
                    lastResult: result
                };
                localStorage.setItem('calculatorData', JSON.stringify(updated));
            } catch (error) {
                console.warn('Failed to track calculator usage:', error);
            }
        };

        // Toast notification system
        let toastId = 0;
        const showToast = (message, type = 'info', duration = 3000) => {
            const toastElement = document.createElement('div');
            const id = `toast-${toastId++}`;
            toastElement.id = id;
            toastElement.className = `toast ${type}`;

            const iconMap = {
                success: 'check-circle',
                error: 'exclamation-circle',
                warning: 'exclamation-triangle',
                info: 'info-circle'
            };

            toastElement.innerHTML = `
                <div class="flex items-center gap-3">
                    <i class="fas fa-${iconMap[type]} text-${type === 'error' ? 'red' : type === 'success' ? 'green' : type === 'warning' ? 'yellow' : 'blue'}-500"></i>
                    <div class="flex-1">
                        <div class="font-medium text-gray-800">${message}</div>
                    </div>
                    <button onclick="document.getElementById('${id}').remove()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;

            document.body.appendChild(toastElement);

            setTimeout(() => {
                if (document.getElementById(id)) {
                    toastElement.classList.add('toast-exit');
                    setTimeout(() => {
                        toastElement.remove();
                    }, 300);
                }
            }, duration);
        };

        // Keyboard shortcuts for power users
        const setupKeyboardShortcuts = () => {
            document.addEventListener('keydown', (e) => {
                // Only activate shortcuts when not in an input field
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') {
                    return;
                }

                if (e.ctrlKey || e.metaKey) {
                    switch (e.key) {
                        case '1':
                            e.preventDefault();
                            document.querySelector('[data-tab="calculator"]')?.click();
                            showToast('Switched to Calculator', 'info', 1000);
                            break;
                        case '2':
                            e.preventDefault();
                            document.querySelector('[data-tab="market-data"]')?.click();
                            showToast('Switched to Market Data', 'info', 1000);
                            break;
                        case '3':
                            e.preventDefault();
                            document.querySelector('[data-tab="guides"]')?.click();
                            showToast('Switched to Guides', 'info', 1000);
                            break;
                        case '4':
                            e.preventDefault();
                            document.querySelector('[data-tab="monte-carlo"]')?.click();
                            showToast('Switched to Monte Carlo', 'info', 1000);
                            break;
                        case 'r':
                            e.preventDefault();
                            if (document.querySelector('[data-tab="market-data"]')?.classList.contains('active')) {
                                document.querySelector('[data-refresh="market"]')?.click();
                                showToast('Refreshing market data...', 'info', 1000);
                            }
                            break;
                        case 'm':
                            e.preventDefault();
                            document.querySelector('[data-simulation="run"]')?.click();
                            break;
                    }
                }
            });
        };

        // Initialize keyboard shortcuts
        if (typeof window !== 'undefined') {
            setupKeyboardShortcuts();
        }

        // Initialize currency API
        if (typeof window !== 'undefined') {
            setupCurrencyAPI();
        }

        // Market Data Setup
        const MARKET_TICKERS = [
            { symbol: 'SPY', name: 'S&P 500 ETF' },
            { symbol: 'VTI', name: 'Total Stock Market ETF' },
            { symbol: 'QQQ', name: 'NASDAQ 100 ETF' },
            { symbol: 'VEA', name: 'Developed Markets ETF' },
            { symbol: 'VWO', name: 'Emerging Markets ETF' },
            { symbol: 'BND', name: 'Total Bond Market ETF' },
            { symbol: 'VNQ', name: 'Real Estate ETF' },
            { symbol: 'GLD', name: 'Gold ETF' },
            { symbol: 'AAPL', name: 'Apple Inc.' },
            { symbol: 'MSFT', name: 'Microsoft Corp.' },
            { symbol: 'GOOGL', name: 'Alphabet Inc.' },
            { symbol: 'AMZN', name: 'Amazon.com Inc.' },
            { symbol: 'TSLA', name: 'Tesla Inc.' },
            { symbol: 'NVDA', name: 'NVIDIA Corp.' }
        ];

        const MARKET_INDICES = [
            { symbol: '^GSPC', name: 'S&P 500', displayName: 'S&P 500' },
            { symbol: '^DJI', name: 'Dow Jones', displayName: 'Dow Jones' },
            { symbol: '^IXIC', name: 'NASDAQ', displayName: 'NASDAQ' },
            { symbol: '^RUT', name: 'Russell 2000', displayName: 'Russell 2000' },
            { symbol: '^VIX', name: 'VIX', displayName: 'VIX' }
        ];

        // Enhanced market data cache with historical data and analytics
        let marketDataCache = {
            data: {},
            lastUpdated: null,
            isLoading: false,
            historical: {}, // Store historical data for trends
            metadata: {
                totalUpdates: 0,
                sessionStart: new Date().toISOString(),
                lastSessionData: null,
                updateFrequency: 1000, // milliseconds
                maxHistoricalPoints: 100 // Keep last 100 data points per symbol
            }
        };

        // Enhanced load function with historical data restoration
        const loadCachedMarketData = () => {
            try {
                const cached = localStorage.getItem('marketDataCache');
                if (cached) {
                    const parsedCache = JSON.parse(cached);
                    const cacheAge = new Date() - new Date(parsedCache.lastUpdated);

                    // Always load historical data and metadata, even if main data is stale
                    if (parsedCache.historical) {
                        marketDataCache.historical = parsedCache.historical;
                    }
                    if (parsedCache.metadata) {
                        marketDataCache.metadata = { ...marketDataCache.metadata, ...parsedCache.metadata };
                    }

                    // Use cache if less than 1 hour old
                    if (cacheAge < 60 * 60 * 1000) {
                        marketDataCache = parsedCache;
                        return parsedCache.data;
                    }
                }
            } catch (error) {
                console.warn('Failed to load cached market data:', error);
            }
            return {};
        };

        // Enhanced save function with historical data and analytics
        const saveCachedMarketData = (data) => {
            try {
                const now = new Date();
                const timestamp = now.toISOString();

                // Update historical data
                Object.keys(data).forEach(symbol => {
                    if (!marketDataCache.historical[symbol]) {
                        marketDataCache.historical[symbol] = [];
                    }

                    const history = marketDataCache.historical[symbol];
                    history.push({
                        timestamp: timestamp,
                        price: data[symbol].price,
                        change: data[symbol].change,
                        changePercent: data[symbol].changePercent,
                        volume: data[symbol].volume
                    });

                    // Keep only last maxHistoricalPoints
                    if (history.length > marketDataCache.metadata.maxHistoricalPoints) {
                        history.shift();
                    }
                });

                // Update metadata
                marketDataCache.metadata.totalUpdates++;
                marketDataCache.metadata.lastSessionData = timestamp;

                const cacheToSave = {
                    data,
                    lastUpdated: timestamp,
                    isLoading: false,
                    historical: marketDataCache.historical,
                    metadata: marketDataCache.metadata
                };

                localStorage.setItem('marketDataCache', JSON.stringify(cacheToSave));
                localStorage.setItem('marketDataCacheTimestamp', timestamp);

                // Also save user session data
                const sessionData = {
                    lastVisit: timestamp,
                    totalSessions: parseInt(localStorage.getItem('totalSessions') || '0') + 1,
                    preferredCurrency: localStorage.getItem('preferredCurrency') || 'USD',
                    lastActiveTab: localStorage.getItem('lastActiveTab') || 'calculator'
                };

                localStorage.setItem('sessionData', JSON.stringify(sessionData));
                localStorage.setItem('totalSessions', sessionData.totalSessions.toString());

                marketDataCache = cacheToSave;
            } catch (error) {
                console.warn('Failed to save market data to cache:', error);
            }
        };

        // Enhanced market data with Finviz-style data structure
        const fetchMarketData = async (symbols = [], forceRefresh = false) => {
            if (marketDataCache.isLoading && !forceRefresh) return marketDataCache.data;

            const now = new Date();
            const cacheAge = marketDataCache.lastUpdated ? now - new Date(marketDataCache.lastUpdated) : Infinity;

            // Use cache if less than 5 minutes old and not forcing refresh
            if (!forceRefresh && cacheAge < 5 * 60 * 1000 && Object.keys(marketDataCache.data).length > 0) {
                return marketDataCache.data;
            }

            marketDataCache.isLoading = true;

            try {
                const allSymbols = symbols.length > 0 ? symbols : [...MARKET_TICKERS.map(t => t.symbol), ...MARKET_INDICES.map(i => i.symbol)];
                const marketData = {};

                // Yahoo Finance API - using a free public API
                const yahooPromises = allSymbols.map(async (symbol) => {
                    try {                        // Clean symbol for Yahoo Finance format
                        const cleanSymbol = symbol.replace('^', '');

                        // Using Yahoo Finance API via a CORS-enabled proxy
                        const response = await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${cleanSymbol}?region=US&lang=en-US&includePrePost=false&interval=1d&useYfid=true&range=1d&corsDomain=finance.yahoo.com`);

                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }

                        const data = await response.json();

                        if (data.chart && data.chart.result && data.chart.result[0]) {
                            const result = data.chart.result[0];
                            const meta = result.meta;
                            const quote = result.indicators.quote[0];

                            const currentPrice = meta.regularMarketPrice || quote.close[quote.close.length - 1];
                            const previousClose = meta.previousClose || quote.close[quote.close.length - 2];
                            const change = currentPrice - previousClose;
                            const changePercent = (change / previousClose) * 100;

                            // Get additional data from Yahoo Finance
                            const summaryResponse = await fetch(`https://query1.finance.yahoo.com/v10/finance/quoteSummary/${cleanSymbol}?modules=summaryDetail,defaultKeyStatistics,financialData,price`);
                            const summaryData = await summaryResponse.json();

                            const summaryDetail = summaryData.quoteSummary?.result?.[0]?.summaryDetail || {};
                            const keyStats = summaryData.quoteSummary?.result?.[0]?.defaultKeyStatistics || {};
                            const financialData = summaryData.quoteSummary?.result?.[0]?.financialData || {};
                            const priceData = summaryData.quoteSummary?.result?.[0]?.price || {};

                            return {
                                symbol,
                                price: currentPrice?.toFixed(2) || '0.00',
                                change: change?.toFixed(2) || '0.00',
                                changePercent: changePercent?.toFixed(2) || '0.00',
                                volume: meta.regularMarketVolume || 0,
                                marketCap: priceData.marketCap?.raw || 0,
                                lastUpdated: now.toISOString(),
                                dayHigh: meta.regularMarketDayHigh || currentPrice,
                                dayLow: meta.regularMarketDayLow || currentPrice,
                                openPrice: quote.open?.[quote.open.length - 1] || currentPrice,
                                previousClose: previousClose,
                                // Extended data from Yahoo Finance
                                pe: keyStats.forwardPE?.raw || keyStats.trailingPE?.raw || 0,
                                dividend: summaryDetail.dividendYield?.raw ? (summaryDetail.dividendYield.raw * 100).toFixed(2) : '0.00',
                                beta: keyStats.beta?.raw?.toFixed(2) || '1.00',
                                avgVolume: meta.averageDailyVolume10Day || 0,
                                week52High: summaryDetail.fiftyTwoWeekHigh?.raw || currentPrice,
                                week52Low: summaryDetail.fiftyTwoWeekLow?.raw || currentPrice,
                                bookValue: keyStats.bookValue?.raw?.toFixed(2) || '0.00',
                                earningsDate: keyStats.earningsDate?.raw ? new Date(keyStats.earningsDate.raw * 1000).toLocaleDateString() : 'N/A',
                                // Financial metrics
                                grossMargin: financialData.grossMargins?.raw ? (financialData.grossMargins.raw * 100).toFixed(1) : '0.0',
                                operatingMargin: financialData.operatingMargins?.raw ? (financialData.operatingMargins.raw * 100).toFixed(1) : '0.0',
                                profitMargin: financialData.profitMargins?.raw ? (financialData.profitMargins.raw * 100).toFixed(1) : '0.0',
                                returnOnAssets: financialData.returnOnAssets?.raw ? (financialData.returnOnAssets.raw * 100).toFixed(1) : '0.0',
                                returnOnEquity: financialData.returnOnEquity?.raw ? (financialData.returnOnEquity.raw * 100).toFixed(1) : '0.0',
                                debtToEquity: financialData.debtToEquity?.raw?.toFixed(2) || '0.00',
                                currentRatio: financialData.currentRatio?.raw?.toFixed(2) || '0.00',
                                // Additional info
                                sector: priceData.sector || 'Unknown',
                                industry: priceData.industry || 'Unknown',
                                shortName: priceData.shortName || symbol,
                                longName: priceData.longName || symbol,
                                // Price history for mini charts (last 20 close prices)
                                priceHistory: quote.close?.slice(-20) || [currentPrice],
                                // Market status
                                marketState: meta.marketState || 'REGULAR',
                                currency: meta.currency || 'USD',
                                exchangeName: meta.exchangeName || 'Unknown'
                            };
                        }
                    } catch (error) {
                        console.warn(`Failed to fetch data for ${symbol}:`, error);
                        // Return fallback data if API fails
                        return getFallbackData(symbol);
                    }
                });

                const results = await Promise.all(yahooPromises);
                results.forEach(data => {
                    if (data) {
                        marketData[data.symbol] = data;
                    }
                });                saveCachedMarketData(marketData);
                marketDataCache.isLoading = false;

                // Show success notification if this is a manual refresh
                if (forceRefresh && typeof showToast !== 'undefined') {
                    showToast(`Market data updated for ${Object.keys(marketData).length} securities`, 'success', 2000);
                }

                return marketData;
            } catch (error) {
                console.warn('Failed to fetch market data:', error);
                marketDataCache.isLoading = false;

                // Show error notification if available
                if (typeof showToast !== 'undefined') {
                    showToast('Using cached market data - API temporarily unavailable', 'warning', 3000);
                }

                // Return cached data if available, otherwise return fallback
                if (Object.keys(marketDataCache.data).length > 0) {
                    return marketDataCache.data;
                } else {
                    return getFallbackMarketData(symbols);
                }
            }
        };

        // Fallback data function for when API fails
        const getFallbackData = (symbol) => {
            const basePrice = getBasePrice(symbol);
            const change = (Math.random() - 0.5) * basePrice * 0.02;
            const changePercent = (change / basePrice) * 100;

            return {
                symbol,
                price: basePrice.toFixed(2),
                change: change.toFixed(2),
                changePercent: changePercent.toFixed(2),
                volume: Math.floor(Math.random() * 10000000),
                marketCap: basePrice * 1000000000,
                lastUpdated: new Date().toISOString(),
                dayHigh: (basePrice * 1.05).toFixed(2),
                dayLow: (basePrice * 0.95).toFixed(2),
                openPrice: (basePrice * 0.98).toFixed(2),
                pe: (Math.random() * 30 + 10).toFixed(2),
                dividend: (Math.random() * 3).toFixed(2),
                beta: (Math.random() * 2 + 0.5).toFixed(2),
                avgVolume: Math.floor(Math.random() * 5000000),
                week52High: (basePrice * 1.3).toFixed(2),
                week52Low: (basePrice * 0.7).toFixed(2),
                sector: getSector(symbol),
                industry: getIndustry(symbol),
                shortName: symbol,
                longName: symbol,
                priceHistory: generatePriceHistory(basePrice, 20),
                marketState: 'REGULAR',
                currency: 'USD',
                exchangeName: 'Unknown'
            };
        };

        // Fallback market data for when all API calls fail
        const getFallbackMarketData = (symbols) => {
            const allSymbols = symbols.length > 0 ? symbols : [...MARKET_TICKERS.map(t => t.symbol), ...MARKET_INDICES.map(i => i.symbol)];
            const fallbackData = {};

            allSymbols.forEach(symbol => {
                fallbackData[symbol] = getFallbackData(symbol);
            });

            return fallbackData;
        };

        // Helper functions for realistic data generation
        const getBasePrice = (symbol) => {
            const prices = {
                'AAPL': 175, 'MSFT': 350, 'GOOGL': 140, 'AMZN': 150, 'TSLA': 200, 'NVDA': 450,
                'SPY': 450, 'QQQ': 380, 'VTI': 240, 'VEA': 50, 'VWO': 40, 'BND': 78,
                'VNQ': 90, 'GLD': 190, '^GSPC': 4500, '^DJI': 35000, '^IXIC': 14000,
                '^RUT': 1800, '^VIX': 18
            };
            return prices[symbol] || (Math.random() * 200 + 20);
        };

        const getSymbolVolatility = (symbol) => {
            const volatilities = {
                'TSLA': 0.025, 'NVDA': 0.025, 'BITCOIN': 0.05, '^VIX': 0.1,
                'SPY': 0.008, 'VTI': 0.008, 'BND': 0.003, 'GLD': 0.012
            };
            return volatilities[symbol] || 0.015;
        };

        const getMarketCap = (symbol, price) => {
            const shares = {
                'AAPL': 15700000000, 'MSFT': 7430000000, 'GOOGL': 13200000000,
                'AMZN': 10700000000, 'TSLA': 3170000000, 'NVDA': 2470000000
            };
            return shares[symbol] ? shares[symbol] * price : Math.floor(Math.random() * 500000000000) + 1000000000;
        };

        const getRealisticVolume = (symbol) => {
            const volumes = {
                'AAPL': 50000000, 'MSFT': 30000000, 'GOOGL': 25000000,
                'AMZN': 35000000, 'TSLA': 80000000, 'NVDA': 40000000,
                'SPY': 60000000, 'QQQ': 45000000, 'VTI': 4000000
            };
            const baseVolume = volumes[symbol] || 5000000;
            return Math.floor(baseVolume * (0.5 + Math.random()));
        };

        const getRealisticPE = (symbol) => {
            const peRanges = {
                'AAPL': [25, 35], 'MSFT': [25, 35], 'GOOGL': [20, 30],
                'AMZN': [50, 80], 'TSLA': [40, 120], 'NVDA': [30, 60]
            };
            const range = peRanges[symbol] || [10, 25];
            return range[0] + Math.random() * (range[1] - range[0]);
        };

        const getRealisticDividend = (symbol) => {
            const dividends = {
                'AAPL': 0.5, 'MSFT': 2.5, 'GOOGL': 0, 'AMZN': 0, 'TSLA': 0,
                'SPY': 1.8, 'VTI': 1.5, 'BND': 3.2, 'VNQ': 3.5, 'GLD': 0
            };
            return dividends[symbol] !== undefined ? dividends[symbol] + Math.random() * 0.3 : Math.random() * 2;
        };

        const getRealisticBeta = (symbol) => {
            const betas = {
                'AAPL': 1.2, 'MSFT': 1.1, 'GOOGL': 1.1, 'AMZN': 1.3,
                'TSLA': 2.0, 'NVDA': 1.8, 'SPY': 1.0, 'VTI': 1.0, 'BND': 0.1
            };
            return betas[symbol] !== undefined ? betas[symbol] + (Math.random() - 0.5) * 0.2 : 0.5 + Math.random() * 1.5;
        };

        const getSector = (symbol) => {
            const sectors = {
                'AAPL': 'Technology', 'MSFT': 'Technology', 'GOOGL': 'Technology',
                'AMZN': 'Consumer Discretionary', 'TSLA': 'Consumer Discretionary',
                'NVDA': 'Technology', 'SPY': 'Index', 'VTI': 'Index',
                'BND': 'Bonds', 'VNQ': 'Real Estate', 'GLD': 'Commodities'
            };
            return sectors[symbol] || 'Mixed';
        };

        const getIndustry = (symbol) => {
            const industries = {
                'AAPL': 'Consumer Electronics', 'MSFT': 'Software', 'GOOGL': 'Internet',
                'AMZN': 'E-commerce', 'TSLA': 'Electric Vehicles', 'NVDA': 'Semiconductors',
                'SPY': 'S&P 500 Index', 'VTI': 'Total Market Index', 'BND': 'Bond Index',
                'VNQ': 'REIT Index', 'GLD': 'Gold ETF'
            };
            return industries[symbol] || 'Diversified';
        };

        const getAnalystRating = () => {
            const ratings = ['Strong Buy', 'Buy', 'Hold', 'Sell', 'Strong Sell'];
            const weights = [0.2, 0.35, 0.35, 0.08, 0.02]; // Weighted towards positive
            const random = Math.random();
            let sum = 0;
            for (let i = 0; i < ratings.length; i++) {
                sum += weights[i];
                if (random < sum) return ratings[i];
            }
            return 'Hold';
        };

        // Generate realistic price history for mini charts
        const generatePriceHistory = (currentPrice, points = 20) => {
            const history = [];
            let price = currentPrice * (0.95 + Math.random() * 0.1); // Start within 5% of current

            for (let i = 0; i < points; i++) {
                const change = (Math.random() - 0.5) * 0.04 * price; // 4% max change
                price = Math.max(0.01, price + change);
                history.push(price);
            }

            return history;
        };

        // Stock search functionality
        const searchStocks = async (query) => {
            if (!query || query.length < 1) return [];

            // Enhanced stock database with more stocks
            const stockDatabase = [
                ...MARKET_TICKERS,
                ...MARKET_INDICES,
                { symbol: 'AAPL', name: 'Apple Inc.' },
                { symbol: 'MSFT', name: 'Microsoft Corporation' },
                { symbol: 'GOOGL', name: 'Alphabet Inc.' },
                { symbol: 'AMZN', name: 'Amazon.com Inc.' },
                { symbol: 'META', name: 'Meta Platforms Inc.' },
                { symbol: 'NFLX', name: 'Netflix Inc.' },
                { symbol: 'INTC', name: 'Intel Corporation' },
                { symbol: 'AMD', name: 'Advanced Micro Devices' },
                { symbol: 'NVDA', name: 'NVIDIA Corporation' },
                { symbol: 'CRM', name: 'Salesforce Inc.' },
                { symbol: 'ORCL', name: 'Oracle Corporation' },
                { symbol: 'ADBE', name: 'Adobe Inc.' },
                { symbol: 'PYPL', name: 'PayPal Holdings Inc.' },
                { symbol: 'UBER', name: 'Uber Technologies Inc.' },
                { symbol: 'LYFT', name: 'Lyft Inc.' },
                { symbol: 'SNAP', name: 'Snap Inc.' },
                { symbol: 'TWTR', name: 'Twitter Inc.' },
                { symbol: 'ZOOM', name: 'Zoom Video Communications' },
                { symbol: 'SHOP', name: 'Shopify Inc.' },
                { symbol: 'SQ', name: 'Block Inc.' },
                { symbol: 'ROKU', name: 'Roku Inc.' },
                { symbol: 'PINS', name: 'Pinterest Inc.' },
                { symbol: 'SPOT', name: 'Spotify Technology' },
                { symbol: 'PLTR', name: 'Palantir Technologies' },
                { symbol: 'COIN', name: 'Coinbase Global Inc.' },
                { symbol: 'RBLX', name: 'Roblox Corporation' },
                { symbol: 'HOOD', name: 'Robinhood Markets Inc.' },
                { symbol: 'DDOG', name: 'Datadog Inc.' },
                { symbol: 'SNOW', name: 'Snowflake Inc.' },
                { symbol: 'CRWD', name: 'CrowdStrike Holdings' },
                { symbol: 'ZM', name: 'Zoom Video Communications' },
                { symbol: 'DOCU', name: 'DocuSign Inc.' },
                { symbol: 'OKTA', name: 'Okta Inc.' },
                { symbol: 'WORK', name: 'Slack Technologies' },
                { symbol: 'TEAM', name: 'Atlassian Corporation' },
                { symbol: 'SPLK', name: 'Splunk Inc.' },
                { symbol: 'WDAY', name: 'Workday Inc.' },
                { symbol: 'VEEV', name: 'Veeva Systems Inc.' },
                { symbol: 'PANW', name: 'Palo Alto Networks' },
                { symbol: 'FTNT', name: 'Fortinet Inc.' },
                { symbol: 'CYBR', name: 'CyberArk Software' },
                { symbol: 'TENB', name: 'Tenable Holdings' },
                { symbol: 'ESTC', name: 'Elastic N.V.' },
                { symbol: 'MDB', name: 'MongoDB Inc.' },
                { symbol: 'FSLY', name: 'Fastly Inc.' },
                { symbol: 'NET', name: 'Cloudflare Inc.' },
                { symbol: 'GTLB', name: 'GitLab Inc.' },
                { symbol: 'DOCN', name: 'DigitalOcean Holdings' },
                { symbol: 'LINODE', name: 'Linode LLC' },
                { symbol: 'VULTR', name: 'Vultr Holdings' }
            ];

            const results = stockDatabase.filter(stock =>
                stock.symbol.toLowerCase().includes(query.toLowerCase()) ||
                stock.name.toLowerCase().includes(query.toLowerCase())
            ).slice(0, 10);

            return results;
        };

        // Initialize with cached data
        if (typeof window !== 'undefined') {
            loadCachedMarketData();
        }

        const ConfigContext = createContext();

        function ConfigProvider({ children }) {
            const [config, setConfig] = useState(() => {
                try {
                    const saved = localStorage.getItem('numbersConfig');
                    return saved ? { ...DEFAULT_CONFIG, ...JSON.parse(saved) } : DEFAULT_CONFIG;
                } catch {
                    return DEFAULT_CONFIG;
                }
            });

            const updateConfig = useCallback((updates) => {
                setConfig(prev => {
                    const newConfig = { ...prev, ...updates };

                    // Handle currency conversion on monetary values when currency changes
                    if (updates.currency && updates.currency !== prev.currency && window.fx && window.fx.rates) {
                        const monetaryFields = ['currentSavings', 'monthlySavings', 'monthlyExpenses'];
                        monetaryFields.forEach(field => {
                            if (newConfig[field] && newConfig[field] > 0) {
                                try {
                                    const convertedValue = fx.convert(newConfig[field], { from: prev.currency, to: updates.currency });
                                    newConfig[field] = Math.round(convertedValue);
                                } catch (error) {
                                    console.warn(`Failed to convert ${field}:`, error);
                                }
                            }
                        });
                    }

                    try {
                        localStorage.setItem('numbersConfig', JSON.stringify(newConfig));

                        // Track usage
                        trackCalculatorUsage('config_update', newConfig);

                        // Save user preferences
                        if (updates.currency) {
                            saveUserPreferences({ currency: updates.currency });
                        }
                    } catch (e) {
                        console.error('Failed to save config:', e);
                    }
                    return newConfig;
                });
            }, []);

            const resetConfig = useCallback(() => {
                setConfig(DEFAULT_CONFIG);
                localStorage.removeItem('numbersConfig');
            }, []);

            return React.createElement(ConfigContext.Provider, {
                value: { config, updateConfig, resetConfig }
            }, children);
        }

        function useConfig() {
            const context = useContext(ConfigContext);
            if (!context) {
                throw new Error('useConfig must be used within ConfigProvider');
            }
            return context;
        }

        // Utility Functions
        const formatCurrency = (amount, currency = 'USD') => {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: currency,
                minimumFractionDigits: 0,
                maximumFractionDigits: 0,
            }).format(amount);
        };

        const formatPercentage = (num) => `${num.toFixed(1)}%`;

        const validateInput = (value, min = 0, max = Infinity) => {
            const num = parseFloat(value) || 0;
            return Math.max(min, Math.min(max, num));
        };

        // Financial Calculations
        const calculateCompoundInterest = ({ principal, monthlySavings, annualRate, years, inflationRate = 0 }) => {
            const realAnnualRate = (annualRate - inflationRate) / 100;
            const monthlyRate = realAnnualRate / 12;
            const totalMonths = years * 12;
            const yearlyData = [];

            let balance = principal;
            for (let month = 1; month <= totalMonths; month++) {
                balance += monthlySavings;
                balance *= (1 + monthlyRate);

                if (month % 12 === 0) {
                    const year = month / 12;
                    const totalContributions = principal + (monthlySavings * month);
                    const interest = balance - totalContributions;
                    yearlyData.push({
                        year,
                        totalValue: Math.round(balance),
                        principal: Math.round(totalContributions),
                        interest: Math.round(interest)
                    });
                }
            }

            const finalTotalContributions = principal + (monthlySavings * totalMonths);
            const finalTotalInterest = balance - finalTotalContributions;

            return {
                totalValue: Math.round(balance),
                totalContributions: Math.round(finalTotalContributions),
                totalInterest: Math.round(finalTotalInterest),
                yearlyData
            };
        };

        const calculateFIRE = ({ monthlyExpenses, currentSavings, monthlySavings, annualReturn, safeWithdrawalRate, inflationRate = 0 }) => {
            const annualExpenses = monthlyExpenses * 12;
            const fireNumber = annualExpenses / (safeWithdrawalRate / 100);
            const stillNeeded = Math.max(0, fireNumber - currentSavings);
            const progressPercentage = fireNumber > 0 ? Math.min(100, (currentSavings / fireNumber) * 100) : 0;

            if (monthlySavings <= 0) {
                return {
                    fireNumber: Math.round(fireNumber),
                    yearsToFIRE: Infinity,
                    stillNeeded: Math.round(stillNeeded),
                    progressPercentage: Math.round(progressPercentage)
                };
            }

            const realAnnualReturn = (annualReturn - inflationRate) / 100;
            const monthlyRate = realAnnualReturn / 12;

            let yearsToFIRE = 0;
            if (stillNeeded > 0 && monthlyRate > 0) {
                try {
                    const monthsToFIRE = Math.log((fireNumber * monthlyRate + monthlySavings) / (currentSavings * monthlyRate + monthlySavings)) / Math.log(1 + monthlyRate);
                    yearsToFIRE = monthsToFIRE / 12;
                } catch {
                    yearsToFIRE = Infinity;
                }
            }

            return {
                fireNumber: Math.round(fireNumber),
                yearsToFIRE: Math.max(0, yearsToFIRE),
                stillNeeded: Math.round(stillNeeded),
                progressPercentage: Math.round(progressPercentage)
            };
        };

        // Components
        function MarketTicker() {
            const [marketData, setMarketData] = useState({});
            const [isLoading, setIsLoading] = useState(true);

            useEffect(() => {
                const loadMarketData = async () => {
                    setIsLoading(true);
                    try {
                        const data = await fetchMarketData(MARKET_INDICES.map(i => i.symbol).slice(0, 5));
                        setMarketData(data);
                    } catch (error) {
                        console.error('Failed to load market data:', error);
                    }
                    setIsLoading(false);
                };

                loadMarketData();
                const interval = setInterval(loadMarketData, 5 * 60 * 1000); // Update every 5 minutes

                return () => clearInterval(interval);
            }, []);

            if (isLoading || Object.keys(marketData).length === 0) {
                return React.createElement('div', { className: 'ticker-container' },
                    React.createElement('div', { className: 'ticker-content' },
                        React.createElement('span', { className: 'ticker-item' }, '📈 Loading market data...')
                    )
                );
            }

            const tickerItems = MARKET_INDICES.map(index => {
                const data = marketData[index.symbol];
                if (!data) return null;

                const isPositive = parseFloat(data.change) >= 0;
                const arrow = isPositive ? '▲' : '▼';
                const colorClass = isPositive ? 'text-green-300' : 'text-red-300';

                return React.createElement('span', { key: index.symbol, className: 'ticker-item' },
                    `${index.displayName}: $${data.price} `,
                    React.createElement('span', { className: colorClass },
                        `${arrow} ${data.change} (${data.changePercent}%)`
                    )
                );
            }).filter(Boolean);

            return React.createElement('div', { className: 'ticker-container' },
                React.createElement('div', { className: 'ticker-content' },
                    ...tickerItems,
                    React.createElement('span', { className: 'ticker-item text-yellow-300' },
                        `🕐 Last updated: ${new Date().toLocaleTimeString()}`
                    )
                )
            );
        }

        function Header() {
            const { config, updateConfig } = useConfig();
            const [exchangeRate, setExchangeRate] = useState(null);
            const [lastUpdated, setLastUpdated] = useState(null);
            const [showCurrencyDropdown, setShowCurrencyDropdown] = useState(false);

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (showCurrencyDropdown && !event.target.closest('.currency-dropdown')) {
                        setShowCurrencyDropdown(false);
                    }
                };

                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, [showCurrencyDropdown]);

            useEffect(() => {
                if (config.currency !== 'USD' && window.fx && window.fx.rates) {
                    const rate = window.fx.rates[config.currency];
                    setExchangeRate(rate);
                    setLastUpdated(new Date().toLocaleTimeString());
                }
            }, [config.currency]);

            const currencyInfo = SUPPORTED_CURRENCIES.find(c => c.value === config.currency);

            const handleCurrencyChange = (currency) => {
                updateConfig({ currency });
                setShowCurrencyDropdown(false);

                // Show success notification
                const currencyInfo = SUPPORTED_CURRENCIES.find(c => c.value === currency);
                if (currencyInfo) {
                    showSuccess(`Currency changed to ${currencyInfo.label.split(' ')[0]} ${currency}`);
                }
            };

            return React.createElement('div', null,
                React.createElement('div', {
                    className: 'bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50 backdrop-blur-sm bg-white/95'
                },
                    React.createElement('div', { className: 'container' },
                        React.createElement('div', { className: 'flex items-center justify-between h-16' },
                            React.createElement('div', { className: 'flex items-center space-x-3' },
                                React.createElement('div', {
                                    className: 'w-10 h-10 bg-primary rounded-lg flex items-center justify-center pulse-subtle'
                                },
                                    React.createElement('i', { className: 'fas fa-calculator text-white text-lg' })
                                ),
                                React.createElement('div', null,
                                    React.createElement('h1', { className: 'text-xl font-bold text-gray-900' }, 'Financial Atlas'),
                                    React.createElement('div', { className: 'text-xs text-gray-500' }, 'Your Financial Independence & Retirement Planner')
                                )
                            ),
                            React.createElement('div', { className: 'flex items-center space-x-4' },
                                React.createElement('div', { className: 'relative currency-dropdown' },
                                    React.createElement('button', {
                                        onClick: () => setShowCurrencyDropdown(!showCurrencyDropdown),
                                        className: 'flex items-center space-x-2 px-3 py-2 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors duration-200 border border-gray-200'
                                    },
                                        React.createElement('span', { className: 'text-lg' }, currencyInfo.label.split(' ')[0]),
                                        React.createElement('span', { className: 'font-medium text-gray-700' }, currencyInfo.value),
                                        React.createElement('i', { className: 'fas fa-chevron-down text-gray-500 text-sm' })
                                    ),
                                    showCurrencyDropdown && React.createElement('div', {
                                        className: 'absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-lg border border-gray-200 z-50 max-h-80 overflow-y-auto'
                                    },
                                        React.createElement('div', { className: 'p-2' },
                                            SUPPORTED_CURRENCIES.map(currency =>
                                                React.createElement('button', {
                                                    key: currency.value,
                                                    onClick: () => handleCurrencyChange(currency.value),
                                                    className: `w-full flex items-center space-x-3 px-3 py-2 text-left hover:bg-gray-50 rounded-lg transition-colors duration-200 ${
                                                        config.currency === currency.value ? 'bg-blue-50 text-blue-700' : 'text-gray-700'
                                                    }`
                                                },
                                                    React.createElement('span', { className: 'text-lg' }, currency.label.split(' ')[0]),
                                                    React.createElement('div', { className: 'flex-1' },
                                                        React.createElement('div', { className: 'font-medium' }, currency.value),
                                                        React.createElement('div', { className: 'text-sm text-gray-500' }, currency.label.split(' ').slice(1).join(' '))
                                                    ),
                                                    config.currency === currency.value && React.createElement('i', { className: 'fas fa-check text-blue-500' })
                                                )
                                            )
                                        )
                                    )
                                ),
                                exchangeRate && config.currency !== 'USD' && React.createElement('div', { className: 'hidden md:flex items-center space-x-2 text-xs text-gray-500' },
                                    React.createElement('i', { className: 'fas fa-exchange-alt' }),
                                    React.createElement('span', null, `1 USD = ${exchangeRate.toFixed(2)} ${config.currency}`)
                                ),
                                React.createElement('div', { className: 'hidden lg:block text-xs text-gray-500' },
                                    lastUpdated && `Updated: ${lastUpdated}`
                                ),
                                React.createElement('div', { className: 'hidden lg:block text-xs text-gray-500 cursor-help', title: 'Keyboard Shortcuts: Ctrl+1-4 for tabs, Ctrl+R for refresh, Ctrl+M for simulation' },
                                    React.createElement('i', { className: 'fas fa-keyboard mr-1' }),
                                    'Shortcuts'
                                )
                            )
                        )
                    )
                ),
                React.createElement(MarketTicker)
            );
        }

        function InputField({ label, field, type = 'number', prefix = '', suffix = '', min = 0, max, step = 1, tooltip = '' }) {
            const { config, updateConfig } = useConfig();
            const value = config[field];

            const handleChange = (e) => {
                const validatedValue = validateInput(e.target.value, min, max);
                updateConfig({ [field]: validatedValue });
            };

            return React.createElement('div', { className: 'form-group' },
                React.createElement('label', { className: 'form-label' },
                    label,
                    tooltip && React.createElement('span', {
                        className: 'ml-1 text-gray-400 cursor-help',
                        title: tooltip
                    }, '?')
                ),
                React.createElement('div', { className: 'relative' },
                    prefix && React.createElement('span', {
                        className: 'absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm'
                    }, prefix),
                    React.createElement('input', {
                        type, value, onChange: handleChange, min, max, step,
                        className: `input-field ${prefix ? 'pl-8' : ''} ${suffix ? 'pr-8' : ''}`,
                        placeholder: `Enter ${label.toLowerCase()}`
                    }),
                    suffix && React.createElement('span', {
                        className: 'absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm'
                    }, suffix)
                )
            );
        }

        function SelectField({ label, field, options, tooltip = '' }) {
            const { config, updateConfig } = useConfig();
            const value = config[field];

            const handleChange = (e) => {
                updateConfig({ [field]: e.target.value });
            };

            return React.createElement('div', { className: 'form-group' },
                React.createElement('label', { className: 'form-label' },
                    label,
                    tooltip && React.createElement('span', {
                        className: 'ml-1 text-gray-400 cursor-help',
                        title: tooltip
                    }, '?')
                ),
                React.createElement('select', {
                    value, onChange: handleChange,
                    className: 'input-field'
                },
                    options.map(opt => React.createElement('option', { key: opt.value, value: opt.value }, opt.label))
                )
            );
        }

        function StatCard({ title, value, subtitle, icon, color = 'primary', animated = true }) {
            const colorMap = {
                primary: 'bg-blue-100 text-blue-600',
                secondary: 'bg-gray-100 text-gray-600',
                success: 'bg-green-100 text-green-600',
                warning: 'bg-yellow-100 text-yellow-600',
                danger: 'bg-red-100 text-red-600'
            };

            const [isVisible, setIsVisible] = useState(false);
            const cardRef = useRef(null);

            useEffect(() => {
                const observer = new IntersectionObserver(
                    ([entry]) => {
                        if (entry.isIntersecting) {
                            setIsVisible(true);
                            observer.disconnect();
                        }
                    },
                    { threshold: 0.1 }
                );

                if (cardRef.current) {
                    observer.observe(cardRef.current);
                }

                return () => observer.disconnect();
            }, []);

            return React.createElement('div', {
                ref: cardRef,
                className: `stat-card ${animated && isVisible ? 'slide-in' : ''} ${animated ? 'card-hover-lift' : ''}`,
                style: { transitionDelay: animated ? `${Math.random() * 200}ms` : '0ms' }
            },
                React.createElement('div', { className: `stat-icon ${colorMap[color]}` },
                    React.createElement('i', { className: `fas fa-${icon}` })
                ),
                React.createElement('div', { className: 'stat-value' }, value),
                React.createElement('div', { className: 'stat-label' }, title),
                subtitle && React.createElement('div', { className: 'text-xs text-gray-500 mt-1' }, subtitle)
            );
        }

        function ChartComponent({ data, options = {}, type = 'line' }) {
            const chartRef = useRef(null);
            const chartInstanceRef = useRef(null);
            const { config } = useConfig();

            useEffect(() => {
                if (!chartRef.current || !window.Chart) return;

                if (chartInstanceRef.current) {
                    chartInstanceRef.current.destroy();
                }

                const defaultOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#374151',
                            bodyColor: '#6B7280',
                            borderColor: '#D1D5DB',
                            borderWidth: 1,
                            cornerRadius: 8,
                            callbacks: {
                                label: (context) => {
                                    const label = context.dataset.label || '';
                                    const value = formatCurrency(context.parsed.y, config.currency);
                                    return `${label}: ${value}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                callback: (value) => formatCurrency(value, config.currency)
                            }
                        }
                    }
                };

                chartInstanceRef.current = new window.Chart(chartRef.current, {
                    type,
                    data,
                    options: { ...defaultOptions, ...options }
                });

                return () => {
                    if (chartInstanceRef.current) {
                        chartInstanceRef.current.destroy();
                    }
                };
            }, [data, options, type, config.currency]);

            return React.createElement('div', { style: { height: '400px' } },
                React.createElement('canvas', { ref: chartRef })
            );
        }

        function TabNavigation({ activeTab, setActiveTab, tabs }) {
            return React.createElement('div', { className: 'tabs' },
                tabs.map(tab =>
                    React.createElement('button', {
                        key: tab.id,
                        className: `tab ${activeTab === tab.id ? 'active' : ''}`,
                        onClick: () => setActiveTab(tab.id),
                        'data-tab': tab.id
                    },
                        React.createElement('i', { className: `fas fa-${tab.icon} mr-2` }),
                        tab.label
                    )
                )
            );
        }

        function Dashboard() {
            const { config } = useConfig();
            const { currency, currentAge, retirementAge } = config;
            const investmentYears = Math.max(0, retirementAge - currentAge);
            const [marketOverview, setMarketOverview] = useState({});

            useEffect(() => {
                const loadQuickMarketData = async () => {
                    try {
                        const data = await fetchMarketData(['SPY', 'VTI', 'QQQ', 'BND']);
                        setMarketOverview(data);
                    } catch (error) {
                        console.error('Failed to load market overview:', error);
                    }
                };
                loadQuickMarketData();
            }, []);

            const fire = useMemo(() => calculateFIRE(config), [config]);
            const compound = useMemo(() => calculateCompoundInterest({
                principal: config.currentSavings,
                monthlySavings: config.monthlySavings,
                annualRate: config.annualReturn,
                years: investmentYears,
                inflationRate: config.inflationRate
            }), [config, investmentYears]);

            const chartData = {
                labels: compound.yearlyData.map(d => `Year ${d.year}`),
                datasets: [
                    {
                        label: 'Total Value',
                        data: compound.yearlyData.map(d => d.totalValue),
                        borderColor: '#3B82F6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'Contributions',
                        data: compound.yearlyData.map(d => d.principal),
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4
                    }
                ]
            };

            const calculatedRetirementAge = fire.yearsToFIRE !== Infinity ?
                Math.round(currentAge + fire.yearsToFIRE) : 'N/A';

            const QuickMarketOverview = () => {
                if (Object.keys(marketOverview).length === 0) return null;

                const marketTickers = [
                    { symbol: 'SPY', name: 'S&P 500 ETF', icon: 'chart-line' },
                    { symbol: 'VTI', name: 'Total Market', icon: 'globe-americas' },
                    { symbol: 'QQQ', name: 'NASDAQ 100', icon: 'microchip' },
                    { symbol: 'BND', name: 'Bonds', icon: 'university' }
                ];

                return React.createElement('div', { className: 'card p-4 mb-4' },
                    React.createElement('div', { className: 'flex justify-between items-center mb-3' },
                        React.createElement('h3', { className: 'text-base font-semibold flex items-center gap-2' },
                            React.createElement('i', { className: 'fas fa-chart-area text-primary text-sm' }),
                            'Market Snapshot'
                        ),
                        React.createElement('a', {
                            href: '#',
                            onClick: (e) => {
                                e.preventDefault();
                                // This would switch to market tab in a real implementation
                                window.dispatchEvent(new CustomEvent('switchTab', { detail: 'market' }));
                            },
                            className: 'text-primary text-xs hover:underline'
                        }, 'View Details →')
                    ),
                    React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-3' },
                        ...marketTickers.map(ticker => {
                            const data = marketOverview[ticker.symbol];
                            if (!data) return null;

                            const isPositive = parseFloat(data.change) >= 0;
                            const changeClass = isPositive ? 'text-green-600' : 'text-red-600';

                            return React.createElement('div', { key: ticker.symbol, className: 'text-center p-2 bg-gray-50 rounded-lg' },
                                React.createElement('div', { className: 'flex items-center justify-center gap-1 mb-1' },
                                    React.createElement('i', { className: `fas fa-${ticker.icon} text-gray-500 text-xs` }),
                                    React.createElement('span', { className: 'font-medium text-gray-800 text-sm' }, ticker.symbol)
                                ),
                                React.createElement('div', { className: 'font-bold text-sm' }, `$${data.price}`),
                                React.createElement('div', { className: `text-xs ${changeClass}` },
                                    `${isPositive ? '+' : ''}${data.changePercent}%`
                                )
                            );
                        })
                    )
                );
            };

            return React.createElement('div', { className: 'fade-in compact-layout' },
                React.createElement('div', { className: 'grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4' },
                    React.createElement('div', { className: 'lg:col-span-2' },
                        React.createElement('div', { className: 'stats-grid' },
                            React.createElement(StatCard, {
                                title: 'FIRE Number',
                                value: formatCurrency(fire.fireNumber, currency),
                                subtitle: 'Target for retirement',
                                icon: 'bullseye',
                                color: 'primary'
                            }),
                            React.createElement(StatCard, {
                                title: 'Years to FIRE',
                                value: fire.yearsToFIRE < 100 ? fire.yearsToFIRE.toFixed(1) : '100+',
                                subtitle: 'At current savings rate',
                                icon: 'clock',
                                color: 'warning'
                            }),
                            React.createElement(StatCard, {
                                title: 'Retirement Age',
                                value: calculatedRetirementAge,
                                subtitle: 'Based on FIRE timeline',
                                icon: 'birthday-cake',
                                color: 'secondary'
                            }),
                            React.createElement(StatCard, {
                                title: 'Projected Savings',
                                value: formatCurrency(compound.totalValue, currency),
                                subtitle: `In ${investmentYears} years`,
                                icon: 'chart-line',
                                color: 'success'
                            })
                        )
                    ),
                    React.createElement('div', { className: 'lg:col-span-1' },
                        React.createElement(QuickMarketOverview)
                    )
                ),
                React.createElement('div', { className: 'chart-container' },
                    React.createElement('h3', { className: 'text-base font-semibold mb-3' }, 'Investment Growth Projection'),
                    React.createElement(ChartComponent, { data: chartData })
                )
            );
        }

        function CompoundInterestCalculator() {
            const { config } = useConfig();
            const { currency, currentAge, retirementAge } = config;
            const investmentYears = Math.max(0, retirementAge - currentAge);

            const results = useMemo(() => calculateCompoundInterest({
                principal: config.currentSavings,
                monthlySavings: config.monthlySavings,
                annualRate: config.annualReturn,
                years: investmentYears,
                inflationRate: config.inflationRate
            }), [config, investmentYears]);

            const chartData = {
                labels: results.yearlyData.map(d => d.year),
                datasets: [
                    {
                        label: 'Total Value',
                        data: results.yearlyData.map(d => d.totalValue),
                        borderColor: '#3B82F6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true
                    },
                    {
                        label: 'Contributions',
                        data: results.yearlyData.map(d => d.principal),
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true
                    }
                ]
            };

            return React.createElement('div', { className: 'fade-in' },
                React.createElement('div', { className: 'chart-container' },
                    React.createElement('h3', { className: 'text-lg font-semibold mb-4' }, 'Compound Interest Growth'),
                    React.createElement(ChartComponent, { data: chartData })
                ),
                React.createElement('div', { className: 'card p-6 text-center' },
                    React.createElement('h4', { className: 'text-lg font-semibold mb-4' }, 'Investment Summary'),
                    React.createElement('p', { className: 'text-gray-600' },
                        `After ${investmentYears} years, your estimated savings will be `,
                        React.createElement('strong', { className: 'text-primary' }, formatCurrency(results.totalValue, currency)),
                        ', with ',
                        React.createElement('strong', { className: 'text-success' }, formatCurrency(results.totalContributions, currency)),
                        ' in contributions and ',
                        React.createElement('strong', { className: 'text-warning' }, formatCurrency(results.totalInterest, currency)),
                        ' in compound interest.'
                    )
                )
            );
        }

        function FIRECalculator() {
            const { config } = useConfig();
            const { currency, currentAge } = config;
            const results = useMemo(() => calculateFIRE(config), [config]);

            const retirementAge = results.yearsToFIRE !== Infinity ?
                Math.round(currentAge + results.yearsToFIRE) : 'N/A';

            return React.createElement('div', { className: 'fade-in' },
                React.createElement('div', { className: 'stats-grid' },
                    React.createElement(StatCard, {
                        title: 'FIRE Number',
                        value: formatCurrency(results.fireNumber, currency),
                        subtitle: 'Your retirement goal',
                        icon: 'bullseye',
                        color: 'primary'
                    }),
                    React.createElement(StatCard, {
                        title: 'Years to FIRE',
                        value: results.yearsToFIRE < 100 ? results.yearsToFIRE.toFixed(1) : '100+',
                        subtitle: 'Time until retirement',
                        icon: 'clock',
                        color: 'warning'
                    }),
                    React.createElement(StatCard, {
                        title: 'Still Needed',
                        value: formatCurrency(results.stillNeeded, currency),
                        subtitle: 'Remaining to reach goal',
                        icon: 'coins',
                        color: 'danger'
                    })
                ),
                React.createElement('div', { className: 'card p-6' },
                    React.createElement('h4', { className: 'text-lg font-semibold mb-4' }, 'Progress to Financial Independence'),
                    React.createElement('div', { className: 'progress-bar' },
                        React.createElement('div', {
                            className: 'progress-fill',
                            style: { width: `${Math.min(results.progressPercentage, 100)}%` }
                        })
                    ),
                    React.createElement('div', { className: 'flex justify-between items-center' },
                        React.createElement('span', { className: 'text-sm text-gray-600' }, 'Progress'),
                        React.createElement('span', { className: 'text-lg font-semibold text-primary' },
                            `${formatPercentage(results.progressPercentage)} Complete`
                        )
                    )
                ),
                React.createElement('div', { className: 'card p-6 text-center' },
                    React.createElement('h4', { className: 'text-lg font-semibold mb-4' }, 'Your FIRE Timeline'),
                    React.createElement('p', { className: 'text-gray-600' },
                        `Based on your current savings plan, you could reach financial independence at age ${retirementAge}.`
                    )
                )
            );
        }

        function MonteCarloSimulator() {
            const { config } = useConfig();
            const { currency, currentAge, retirementAge } = config;
            const investmentYears = Math.max(0, retirementAge - currentAge);
            const [simulation, setSimulation] = useState({ running: false, results: null, progress: 0 });

            const runSimulation = () => {
                setSimulation({ running: true, results: null, progress: 0 });

                // Simulate progress updates
                const progressInterval = setInterval(() => {
                    setSimulation(prev => ({
                        ...prev,
                        progress: Math.min(prev.progress + Math.random() * 15, 95)
                    }));
                }, 100);

                // Enhanced Monte Carlo simulation with user-controlled batch processing
                const { currentSavings, monthlySavings, annualReturn, volatility, numSimulations } = config;
                const results = [];
                let completedSimulations = 0;
                let cancelled = false;
                const batchSize = Math.min(100, numSimulations); // Process in batches for better performance

                // Store cancel function for cleanup
                const cancelSimulation = () => {
                    cancelled = true;
                    clearInterval(progressInterval);
                    setSimulation({ running: false, progress: 0, results: null });
                };

                // Store cancel function globally for access
                window.cancelCurrentSimulation = cancelSimulation;

                const runBatch = () => {
                    if (cancelled) return;

                    const currentBatch = Math.min(batchSize, numSimulations - completedSimulations);

                    for (let i = 0; i < currentBatch; i++) {
                        if (cancelled) return;

                        let balance = currentSavings;
                        for (let year = 0; year < investmentYears; year++) {
                            const randomReturn = annualReturn + (Math.random() - 0.5) * volatility;
                            balance += monthlySavings * 12;
                            balance *= (1 + randomReturn / 100);
                        }
                        results.push(balance);
                    }

                    completedSimulations += currentBatch;
                    const progress = (completedSimulations / numSimulations) * 100;

                    setSimulation(prev => ({
                        ...prev,
                        progress: Math.min(progress, 100)
                    }));

                    if (completedSimulations < numSimulations && !cancelled) {
                        // Continue processing in next frame for better UI responsiveness
                        setTimeout(runBatch, 10);
                    } else if (!cancelled) {
                        // All simulations complete
                        clearInterval(progressInterval);
                        results.sort((a, b) => a - b);
                        const percentile10 = results[Math.floor(results.length * 0.1)];
                        const median = results[Math.floor(results.length * 0.5)];
                        const percentile90 = results[Math.floor(results.length * 0.9)];                        setSimulation({
                            running: false,
                            progress: 100,
                            results: { percentile10, median, percentile90 }
                        });

                        // Show success notification
                        showSuccess(`Monte Carlo simulation completed with ${numSimulations.toLocaleString()} iterations!`);

                        // Track simulation completion
                        trackCalculatorUsage('monte_carlo_simulation', {
                            numSimulations,
                            results: { percentile10, median, percentile90 }
                        });

                        // Clean up cancel function
                        window.cancelCurrentSimulation = null;
                    }
                };

                // Start batch processing
                setTimeout(runBatch, 100);
            };

            const cancelSimulation = () => {
                if (window.cancelCurrentSimulation) {
                    window.cancelCurrentSimulation();
                }
            };

            return React.createElement('div', { className: 'fade-in' },
                React.createElement('div', { className: 'gradient-border' },
                    React.createElement('div', null,
                        React.createElement('h3', { className: 'text-lg font-semibold mb-4' }, 'Monte Carlo Simulation'),
                        React.createElement('p', { className: 'text-gray-600 mb-6' },
                            'Run thousands of simulations to see a probabilistic range of your potential retirement savings based on market volatility.'
                        ),
                        React.createElement('div', { className: 'form-grid mb-6' },
                            React.createElement(InputField, {
                                label: 'Market Volatility',
                                field: 'volatility',
                                suffix: '%',
                                min: 0,
                                max: 50,
                                tooltip: 'Historical average is around 15-20% for stock markets. Higher volatility = wider range of outcomes.'
                            }),
                            React.createElement(InputField, {
                                label: 'Number of Simulations',
                                field: 'numSimulations',
                                min: 100,
                                max: 10000,
                                step: 100,
                                tooltip: 'More simulations = more accurate results but longer processing time. Recommended: 1000-5000.'
                            })
                        ),
                        React.createElement('div', { className: 'flex items-center gap-4 mb-6' },
                            React.createElement('div', { className: 'flex items-center gap-2' },
                                React.createElement('i', { className: 'fas fa-info-circle text-blue-500' }),
                                React.createElement('span', { className: 'text-sm text-gray-600' },
                                    `${config.numSimulations.toLocaleString()} simulations will be run`
                                )
                            ),
                            React.createElement('div', { className: 'flex items-center gap-2' },
                                React.createElement('i', { className: 'fas fa-clock text-green-500' }),
                                React.createElement('span', { className: 'text-sm text-gray-600' },
                                    `Est. time: ${Math.ceil(config.numSimulations / 1000)}s`
                                )
                            )
                        ),
                        React.createElement('div', { className: 'mb-6' },
                            React.createElement('div', { className: 'flex items-center gap-2 mb-2' },
                                React.createElement('span', { className: 'text-sm font-medium text-gray-700' }, 'Quick Presets:')
                            ),
                            React.createElement('div', { className: 'flex gap-2 flex-wrap' },
                                [500, 1000, 2500, 5000, 10000].map(count =>
                                    React.createElement('button', {
                                        key: count,
                                        onClick: () => updateConfig('numSimulations', count),
                                        className: `px-3 py-1 text-xs rounded-full border transition-all ${
                                            config.numSimulations === count
                                                ? 'bg-blue-500 text-white border-blue-500'
                                                : 'bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200'
                                        }`
                                    }, `${count.toLocaleString()}`)
                                )
                            )
                        ),
                        React.createElement('div', { className: 'flex gap-3' },
                            React.createElement('button', {
                                onClick: runSimulation,
                                disabled: simulation.running,
                                'data-simulation': 'run',
                                className: `btn btn-primary flex-1 ${simulation.running ? 'shimmer' : ''}`
                            },
                                simulation.running ?
                                    React.createElement('span', { className: 'flex items-center justify-center gap-2' },
                                        React.createElement('span', { className: 'loading-spinner' }),
                                        `Running... ${Math.round(simulation.progress)}%`
                                    ) :
                                    React.createElement('span', { className: 'flex items-center justify-center gap-2' },
                                        React.createElement('i', { className: 'fas fa-play' }),
                                        'Run Monte Carlo Simulation'
                                    )
                            ),
                            simulation.running && React.createElement('button', {
                                onClick: cancelSimulation,
                                className: 'btn bg-red-500 hover:bg-red-600 text-white px-4'
                            },
                                React.createElement('i', { className: 'fas fa-stop' })
                            )
                        ),
                        simulation.running && React.createElement('div', { className: 'progress-bar mt-4' },
                            React.createElement('div', {
                                className: 'progress-fill',
                                style: { width: `${simulation.progress}%` }
                            })
                        )
                    )
                ),
                simulation.results && React.createElement('div', { className: 'stats-grid slide-in' },
                    React.createElement(StatCard, {
                        title: 'Pessimistic (10th %)',
                        value: formatCurrency(simulation.results.percentile10, currency),
                        subtitle: 'Worst 10% of outcomes',
                        icon: 'arrow-down',
                        color: 'danger',
                        animated: true
                    }),
                    React.createElement(StatCard, {
                        title: 'Expected (50th %)',
                        value: formatCurrency(simulation.results.median, currency),
                        subtitle: 'Median result',
                        icon: 'balance-scale',
                        color: 'primary',
                        animated: true
                    }),
                    React.createElement(StatCard, {
                        title: 'Optimistic (90th %)',
                        value: formatCurrency(simulation.results.percentile90, currency),
                        subtitle: 'Best 10% of outcomes',
                        icon: 'arrow-up',
                        color: 'success',
                        animated: true
                    })
                )
            );
        }

        function Guide() {
            const [selectedArticle, setSelectedArticle] = useState(null);

            const articles = [
                {
                    id: 'fire',
                    icon: 'fire',
                    title: 'Understanding FIRE (Financial Independence, Retire Early)',
                    content: `
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl mb-6 border border-blue-200">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">What is FIRE?</h3>
                            <p class="text-gray-600">FIRE stands for Financial Independence, Retire Early. It's a lifestyle movement focused on extreme saving and investing to allow retirement much earlier than traditional retirement plans.</p>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-blue-600">Core FIRE Principles</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🏦 High Savings Rate</h4>
                                <p class="text-sm text-gray-600">FIRE adherents typically save 50-70% of their income, far exceeding the traditional 10-20% recommendation.</p>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">💰 Aggressive Investing</h4>
                                <p class="text-sm text-gray-600">Focus on low-cost index funds and ETFs with consistent market returns over time.</p>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🎯 Expense Optimization</h4>
                                <p class="text-sm text-gray-600">Ruthlessly cutting unnecessary expenses while maintaining quality of life.</p>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">📊 Data-Driven Approach</h4>
                                <p class="text-sm text-gray-600">Using calculators and tracking to optimize every financial decision.</p>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-blue-600">Types of FIRE</h3>
                        <ul class="space-y-3 mb-6">
                            <li class="flex items-start space-x-3">
                                <span class="text-amber-500 font-bold mt-1">•</span>
                                <div>
                                    <strong class="text-gray-800">Lean FIRE:</strong>
                                    <span class="text-gray-600 ml-2">Retiring with minimal expenses (typically $40,000-$50,000 annually)</span>
                                </div>
                            </li>
                            <li class="flex items-start space-x-3">
                                <span class="text-amber-500 font-bold mt-1">•</span>
                                <div>
                                    <strong class="text-gray-800">Regular FIRE:</strong>
                                    <span class="text-gray-600 ml-2">Maintaining current lifestyle in retirement ($50,000-$100,000 annually)</span>
                                </div>
                            </li>
                            <li class="flex items-start space-x-3">
                                <span class="text-amber-500 font-bold mt-1">•</span>
                                <div>
                                    <strong class="text-gray-800">Fat FIRE:</strong>
                                    <span class="text-gray-600 ml-2">Retiring with a luxurious lifestyle ($100,000+ annually)</span>
                                </div>
                            </li>
                            <li class="flex items-start space-x-3">
                                <span class="text-amber-500 font-bold mt-1">•</span>
                                <div>
                                    <strong class="text-gray-800">Coast FIRE:</strong>
                                    <span class="text-gray-600 ml-2">Having enough saved that compound interest will grow to retirement needs by traditional retirement age</span>
                                </div>
                            </li>
                        </ul>

                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                            <h4 class="font-semibold text-blue-800 mb-2">💡 Pro Tip</h4>
                            <p class="text-sm text-blue-700">Start with small improvements to your savings rate. Even increasing from 10% to 20% can cut decades off your working career!</p>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-blue-600">Getting Started</h3>
                        <ol class="list-decimal list-inside space-y-2 text-gray-600">
                            <li>Calculate your current expenses and savings rate</li>
                            <li>Set a target FIRE number (typically 25x annual expenses)</li>
                            <li>Open investment accounts (401k, IRA, taxable brokerage)</li>
                            <li>Choose low-cost index funds</li>
                            <li>Automate investments and track progress</li>
                        </ol>
                    `
                },
                {
                    id: '4-percent-rule',
                    icon: 'calculator',
                    title: 'The 4% Safe Withdrawal Rate (SWR)',
                    content: `
                        <div class="bg-gradient-to-r from-amber-50 to-yellow-50 p-6 rounded-xl mb-6 border border-amber-200">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">The Foundation of FIRE</h3>
                            <p class="text-gray-600">The 4% Rule is the cornerstone of FIRE planning, determining how much you can safely withdraw from your portfolio each year in retirement.</p>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-amber-600">How the 4% Rule Works</h3>
                        <p class="mb-4 text-gray-600">Based on the Trinity Study and historical market data, withdrawing 4% of your initial portfolio value annually (adjusted for inflation) has a 95% success rate over 30-year periods.</p>

                        <div class="bg-white border border-gray-200 rounded-lg p-6 mb-6 shadow-sm">
                            <h4 class="font-semibold text-gray-800 mb-3">📊 The Math</h4>
                            <div class="space-y-2 text-sm">
                                <p class="text-gray-600"><strong>FIRE Number = Annual Expenses ÷ 0.04</strong></p>
                                <p class="text-gray-600">Or: <strong>Annual Expenses × 25</strong></p>
                                <div class="bg-blue-50 p-3 rounded mt-3 border border-blue-200">
                                    <p class="text-blue-700"><strong>Example:</strong> If you spend $50,000/year, your FIRE number is $1,250,000</p>
                                </div>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-amber-600">Historical Context</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">📈 Trinity Study (1998)</h4>
                                <p class="text-sm text-gray-600">Analyzed withdrawal rates from 1925-1995, showing 4% succeeded in 95% of 30-year periods.</p>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🏛️ Portfolio Composition</h4>
                                <p class="text-sm text-gray-600">Based on 50-75% stocks, 25-50% bonds for balanced growth and stability.</p>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-amber-600">Modern Considerations</h3>
                        <div class="space-y-4 mb-6">
                            <div class="border-l-4 border-amber-500 pl-4">
                                <h4 class="font-semibold text-gray-800">Sequence of Returns Risk</h4>
                                <p class="text-sm text-gray-600 mt-1">Poor market performance early in retirement can devastate a portfolio. Consider a lower withdrawal rate (3-3.5%) for early retirement.</p>
                            </div>
                            <div class="border-l-4 border-blue-500 pl-4">
                                <h4 class="font-semibold text-gray-800">Inflation Impact</h4>
                                <p class="text-sm text-gray-600 mt-1">Current low interest rates and potential higher inflation may require adjusting the traditional 4% rule.</p>
                            </div>
                            <div class="border-l-4 border-green-500 pl-4">
                                <h4 class="font-semibold text-gray-800">Flexible Withdrawal</h4>
                                <p class="text-sm text-gray-600 mt-1">Consider guardrails: reduce spending in bad market years, increase in good years.</p>
                            </div>
                        </div>

                        <div class="bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6">
                            <h4 class="font-semibold text-amber-800 mb-2">⚠️ Important Note</h4>
                            <p class="text-sm text-amber-700">The 4% rule is a guideline, not a guarantee. Market conditions, inflation, and personal circumstances all matter. Many FIRE practitioners use 3-3.5% to be conservative.</p>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-amber-600">Alternative Withdrawal Strategies</h3>
                        <ul class="space-y-3">
                            <li class="flex items-start space-x-3">
                                <span class="text-amber-500 font-bold mt-1">•</span>
                                <div>
                                    <strong class="text-gray-800">Bond Tent:</strong>
                                    <span class="text-gray-600 ml-2">Gradually increase bond allocation as you approach retirement</span>
                                </div>
                            </li>
                            <li class="flex items-start space-x-3">
                                <span class="text-amber-500 font-bold mt-1">•</span>
                                <div>
                                    <strong class="text-gray-800">Bucket Strategy:</strong>
                                    <span class="text-gray-600 ml-2">Separate short-term (cash), medium-term (bonds), and long-term (stocks) buckets</span>
                                </div>
                            </li>
                            <li class="flex items-start space-x-3">
                                <span class="text-amber-500 font-bold mt-1">•</span>
                                <div>
                                    <strong class="text-gray-800">Dynamic Withdrawal:</strong>
                                    <span class="text-gray-600 ml-2">Adjust withdrawal rates based on market performance and portfolio value</span>
                                </div>
                            </li>
                        </ul>
                    `
                },
                {
                    id: 'lazy-portfolios',
                    icon: 'chart-pie',
                    title: 'Lazy Portfolios & Index Investing',
                    content: `
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-xl mb-6 border border-green-200">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">Set It and Forget It Investing</h3>
                            <p class="text-gray-600">Lazy portfolios are simple, low-maintenance investment strategies that outperform most active management with minimal effort.</p>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-green-600">Why Lazy Portfolios Work</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">💸 Low Costs</h4>
                                <p class="text-sm text-gray-600">Index funds have expense ratios of 0.03-0.20% vs 0.5-2% for actively managed funds.</p>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">📈 Market Returns</h4>
                                <p class="text-sm text-gray-600">Captures full market performance without trying to beat it.</p>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🎯 Simplicity</h4>
                                <p class="text-sm text-gray-600">No need to research individual stocks or time the market.</p>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🔄 Automatic Diversification</h4>
                                <p class="text-sm text-gray-600">Instant exposure to hundreds or thousands of companies.</p>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-green-600">Popular Lazy Portfolio Strategies</h3>

                        <div class="space-y-6 mb-6">
                            <div class="border border-green-200 rounded-lg p-4 bg-green-50">
                                <h4 class="font-semibold text-gray-800 mb-3">🏆 Three-Fund Portfolio</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">Total Stock Market (VTSAX/VTI)</span>
                                        <span class="font-medium text-gray-800">60-70%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">International Stock (VTIAX/VXUS)</span>
                                        <span class="font-medium text-gray-800">20-30%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">Total Bond Market (VBTLX/BND)</span>
                                        <span class="font-medium text-gray-800">10-20%</span>
                                    </div>
                                </div>
                            </div>

                            <div class="border border-blue-200 rounded-lg p-4 bg-blue-50">
                                <h4 class="font-semibold text-gray-800 mb-3">🎯 Target Date Funds</h4>
                                <p class="text-sm text-gray-600 mb-2">Single fund that automatically adjusts allocation based on retirement date.</p>
                                <div class="text-sm text-gray-600">
                                    <strong>Examples:</strong> VTRLX (2055), VTTSX (2060), VFORX (2040)
                                </div>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-green-600">Recommended Brokers & Funds</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🏛️ Vanguard</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• VTSAX (Total Stock)</li>
                                    <li>• VTIAX (International)</li>
                                    <li>• VBTLX (Bonds)</li>
                                    <li>• Ultra-low fees</li>
                                </ul>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">💎 Fidelity</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• FZROX (Zero fees!)</li>
                                    <li>• FTIHX (International)</li>
                                    <li>• FXNAX (Bonds)</li>
                                    <li>• Great interface</li>
                                </ul>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🎯 Charles Schwab</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• SWTSX (Total Stock)</li>
                                    <li>• SWISX (International)</li>
                                    <li>• SWAGX (Bonds)</li>
                                    <li>• Excellent service</li>
                                </ul>
                            </div>
                        </div>

                        <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                            <h4 class="font-semibold text-green-800 mb-2">💡 Rebalancing Strategy</h4>
                            <p class="text-sm text-green-700">Rebalance annually or when allocation drifts 5-10% from target. Use new contributions to rebalance when possible to avoid tax consequences.</p>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-green-600">Getting Started</h3>
                        <ol class="list-decimal list-inside space-y-2 text-gray-600">
                            <li>Max out 401(k) match (free money!)</li>
                            <li>Open IRA (Traditional or Roth)</li>
                            <li>Choose your allocation based on age and risk tolerance</li>
                            <li>Set up automatic investments</li>
                            <li>Review and rebalance annually</li>
                            <li>Stay the course through market volatility</li>
                        </ol>
                    `
                },
                {
                    id: 'psychology',
                    icon: 'brain',
                    title: 'Psychology & Behavioral Finance',
                    content: `
                        <div class="bg-gradient-to-r from-purple-50 to-indigo-50 p-6 rounded-xl mb-6 border border-purple-200">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">Master Your Mind, Master Your Money</h3>
                            <p class="text-gray-600">The biggest barriers to FIRE success are often psychological. Understanding behavioral biases helps you make better financial decisions.</p>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-purple-600">Common Behavioral Biases</h3>
                        <div class="space-y-4 mb-6">
                            <div class="border border-purple-200 rounded-lg p-4 bg-purple-50">
                                <h4 class="font-semibold text-gray-800 mb-2">🎯 Loss Aversion</h4>
                                <p class="text-sm text-gray-600 mb-2">People feel losses twice as strongly as equivalent gains.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Solution:</strong> Focus on long-term gains, not short-term market volatility
                                </div>
                            </div>

                            <div class="border border-blue-200 rounded-lg p-4 bg-blue-50">
                                <h4 class="font-semibold text-gray-800 mb-2">📈 Recency Bias</h4>
                                <p class="text-sm text-gray-600 mb-2">Overweighting recent events when making decisions.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Solution:</strong> Study long-term market history, not just recent years
                                </div>
                            </div>

                            <div class="border border-amber-200 rounded-lg p-4 bg-amber-50">
                                <h4 class="font-semibold text-gray-800 mb-2">🧠 Analysis Paralysis</h4>
                                <p class="text-sm text-gray-600 mb-2">Overthinking investment decisions instead of taking action.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Solution:</strong> Start with simple index funds, optimize later
                                </div>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-purple-600">Building the Right Mindset</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🎯 Growth Mindset</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• View setbacks as learning opportunities</li>
                                    <li>• Embrace continuous improvement</li>
                                    <li>• Focus on process, not just outcomes</li>
                                    <li>• Celebrate small wins</li>
                                </ul>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">⚖️ Abundance Mentality</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Money is a tool, not a goal</li>
                                    <li>• Focus on value, not just cost</li>
                                    <li>• Invest in experiences and relationships</li>
                                    <li>• Give back to community</li>
                                </ul>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-purple-600">Dealing with Market Volatility</h3>
                        <div class="space-y-4 mb-6">
                            <div class="border-l-4 border-purple-500 pl-4">
                                <h4 class="font-semibold text-gray-800">Dollar-Cost Averaging</h4>
                                <p class="text-sm text-gray-600 mt-1">Invest the same amount regularly regardless of market conditions. Reduces timing risk and emotional decisions.</p>
                            </div>
                            <div class="border-l-4 border-blue-500 pl-4">
                                <h4 class="font-semibold text-gray-800">Reframe Market Drops</h4>
                                <p class="text-sm text-gray-600 mt-1">View market downturns as "sales" - you're buying more shares for the same dollar amount.</p>
                            </div>
                            <div class="border-l-4 border-green-500 pl-4">
                                <h4 class="font-semibold text-gray-800">Emergency Fund Peace of Mind</h4>
                                <p class="text-sm text-gray-600 mt-1">3-6 months of expenses in cash reduces anxiety about market volatility.</p>
                            </div>
                        </div>

                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-6">
                            <h4 class="font-semibold text-purple-800 mb-2">👥 Common Social Pressures</h4>
                            <ul class="text-sm text-purple-700 space-y-1">
                                <li>• Lifestyle inflation pressure from peers</li>
                                <li>• Family criticism of "extreme" saving</li>
                                <li>• FOMO on expensive experiences</li>
                                <li>• Partner disagreements on spending</li>
                            </ul>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-purple-600">Automation & Systems</h3>
                        <p class="text-sm text-gray-600 mb-4">Remove emotion from financial decisions by automating good behaviors.</p>

                        <div class="space-y-3 mb-6">
                            <div class="bg-white border border-gray-200 rounded-lg p-3 shadow-sm">
                                <h4 class="font-medium text-gray-800 mb-1">🤖 Automate Investments</h4>
                                <p class="text-xs text-gray-600">Set up automatic transfers to investment accounts on payday</p>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-3 shadow-sm">
                                <h4 class="font-medium text-gray-800 mb-1">📊 Track Net Worth</h4>
                                <p class="text-xs text-gray-600">Monthly tracking keeps you motivated and on track</p>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-3 shadow-sm">
                                <h4 class="font-medium text-gray-800 mb-1">🎯 Use Specific Goals</h4>
                                <p class="text-xs text-gray-600">"Save $500,000 by age 40" vs "save more money"</p>
                            </div>
                        </div>

                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <h4 class="font-semibold text-purple-800 mb-2">💡 Remember Your Why</h4>
                            <p class="text-sm text-purple-700">FIRE isn't about deprivation - it's about freedom. Financial independence gives you the power to choose how you spend your time and energy.</p>
                        </div>
                    `
                },
                {
                    id: 'psychology',
                    icon: 'brain',
                    title: 'Psychology & Behavioral Finance',
                    content: `
                        <div class="bg-gradient-to-r from-purple-50 to-indigo-50 p-6 rounded-xl mb-6 border border-purple-200">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">Master Your Mind, Master Your Money</h3>
                            <p class="text-gray-600">The biggest barriers to FIRE success are often psychological. Understanding behavioral biases helps you make better financial decisions.</p>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-purple-600">Common Behavioral Biases</h3>
                        <div class="space-y-4 mb-6">
                            <div class="border border-purple-200 rounded-lg p-4 bg-purple-50">
                                <h4 class="font-semibold text-gray-800 mb-2">🎯 Loss Aversion</h4>
                                <p class="text-sm text-gray-600 mb-2">People feel losses twice as strongly as equivalent gains.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Solution:</strong> Focus on long-term gains, not short-term market volatility
                                </div>
                            </div>

                            <div class="border border-blue-200 rounded-lg p-4 bg-blue-50">
                                <h4 class="font-semibold text-gray-800 mb-2">📈 Recency Bias</h4>
                                <p class="text-sm text-gray-600 mb-2">Overweighting recent events when making decisions.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Solution:</strong> Study long-term market history, not just recent years
                                </div>
                            </div>

                            <div class="border border-amber-200 rounded-lg p-4 bg-amber-50">
                                <h4 class="font-semibold text-gray-800 mb-2">🧠 Analysis Paralysis</h4>
                                <p class="text-sm text-gray-600 mb-2">Overthinking investment decisions instead of taking action.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Solution:</strong> Start with simple index funds, optimize later
                                </div>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-purple-600">Building the Right Mindset</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🎯 Growth Mindset</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• View setbacks as learning opportunities</li>
                                    <li>• Embrace continuous improvement</li>
                                    <li>• Focus on process, not just outcomes</li>
                                    <li>• Celebrate small wins</li>
                                </ul>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">⚖️ Abundance Mentality</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Money is a tool, not a goal</li>
                                    <li>• Focus on value, not just cost</li>
                                    <li>• Invest in experiences and relationships</li>
                                    <li>• Give back to community</li>
                                </ul>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-purple-600">Dealing with Market Volatility</h3>
                        <div class="space-y-4 mb-6">
                            <div class="border-l-4 border-purple-500 pl-4">
                                <h4 class="font-semibold text-gray-800">Dollar-Cost Averaging</h4>
                                <p class="text-sm text-gray-600 mt-1">Invest the same amount regularly regardless of market conditions. Reduces timing risk and emotional decisions.</p>
                            </div>
                            <div class="border-l-4 border-blue-500 pl-4">
                                <h4 class="font-semibold text-gray-800">Reframe Market Drops</h4>
                                <p class="text-sm text-gray-600 mt-1">View market downturns as "sales" - you're buying more shares for the same dollar amount.</p>
                            </div>
                            <div class="border-l-4 border-green-500 pl-4">
                                <h4 class="font-semibold text-gray-800">Emergency Fund Peace of Mind</h4>
                                <p class="text-sm text-gray-600 mt-1">3-6 months of expenses in cash reduces anxiety about market volatility.</p>
                            </div>
                        </div>

                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-6">
                            <h4 class="font-semibold text-purple-800 mb-2">👥 Common Social Pressures</h4>
                            <ul class="text-sm text-purple-700 space-y-1">
                                <li>• Lifestyle inflation pressure from peers</li>
                                <li>• Family criticism of "extreme" saving</li>
                                <li>• FOMO on expensive experiences</li>
                                <li>• Partner disagreements on spending</li>
                            </ul>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-purple-600">Automation & Systems</h3>
                        <p class="text-sm text-gray-600 mb-4">Remove emotion from financial decisions by automating good behaviors.</p>

                        <div class="space-y-3 mb-6">
                            <div class="bg-white border border-gray-200 rounded-lg p-3 shadow-sm">
                                <h4 class="font-medium text-gray-800 mb-1">🤖 Automate Investments</h4>
                                <p class="text-xs text-gray-600">Set up automatic transfers to investment accounts on payday</p>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-3 shadow-sm">
                                <h4 class="font-medium text-gray-800 mb-1">📊 Track Net Worth</h4>
                                <p class="text-xs text-gray-600">Monthly tracking keeps you motivated and on track</p>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-3 shadow-sm">
                                <h4 class="font-medium text-gray-800 mb-1">🎯 Use Specific Goals</h4>
                                <p class="text-xs text-gray-600">"Save $500,000 by age 40" vs "save more money"</p>
                            </div>
                        </div>

                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <h4 class="font-semibold text-purple-800 mb-2">💡 Remember Your Why</h4>
                            <p class="text-sm text-purple-700">FIRE isn't about deprivation - it's about freedom. Financial independence gives you the power to choose how you spend your time and energy.</p>
                        </div>
                    `
                },
                {
                    id: 'tax-strategies',
                    icon: 'receipt',
                    title: 'Tax-Advantaged Accounts & Strategies',
                    content: `
                        <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-xl mb-6 border border-indigo-200">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">Maximize Your Tax Efficiency</h3>
                            <p class="text-gray-600">Tax-advantaged accounts can accelerate your FIRE journey by reducing your tax burden and maximizing compound growth.</p>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-indigo-600">The FIRE Tax Strategy Hierarchy</h3>
                        <div class="space-y-4 mb-6">
                            <div class="border border-indigo-200 rounded-lg p-4 bg-indigo-50">
                                <h4 class="font-semibold text-gray-800 mb-2">1️⃣ Employer 401(k) Match</h4>
                                <p class="text-sm text-gray-600 mb-2">Free money! Always contribute enough to get the full employer match.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Typical match:</strong> 50% or 100% of contributions up to 3-6% of salary
                                </div>
                            </div>

                            <div class="border border-green-200 rounded-lg p-4 bg-green-50">
                                <h4 class="font-semibold text-gray-800 mb-2">2️⃣ High-Yield Savings (Emergency Fund)</h4>
                                <p class="text-sm text-gray-600 mb-2">3-6 months of expenses in a high-yield savings account.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Current rates:</strong> 4-5% APY at online banks like Marcus, Ally, or Capital One
                                </div>
                            </div>

                            <div class="border border-blue-200 rounded-lg p-4 bg-blue-50">
                                <h4 class="font-semibold text-gray-800 mb-2">3️⃣ IRA (Traditional vs Roth)</h4>
                                <p class="text-sm text-gray-600 mb-2">$7,000 annual limit (2024), or $8,000 if 50+</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Traditional:</strong> Tax deduction now, pay taxes in retirement<br>
                                    <strong>Roth:</strong> No deduction now, tax-free withdrawals in retirement
                                </div>
                            </div>

                            <div class="border border-amber-200 rounded-lg p-4 bg-amber-50">
                                <h4 class="font-semibold text-gray-800 mb-2">4️⃣ Max Out 401(k)</h4>
                                <p class="text-sm text-gray-600 mb-2">$23,000 annual limit (2024), or $30,500 if 50+</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Pro tip:</strong> If available, consider Roth 401(k) for tax diversification
                                </div>
                            </div>

                            <div class="border border-purple-200 rounded-lg p-4 bg-purple-50">
                                <h4 class="font-semibold text-gray-800 mb-2">5️⃣ Taxable Brokerage</h4>
                                <p class="text-sm text-gray-600 mb-2">No contribution limits, but no tax advantages</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Essential for FIRE:</strong> Provides access to funds before age 59½
                                </div>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-indigo-600">Advanced Strategies</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🏥 HSA (Health Savings Account)</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Triple tax advantage</li>
                                    <li>• $4,300 individual / $8,550 family (2024)</li>
                                    <li>• Invest like an IRA after $2,000</li>
                                    <li>• Becomes IRA at age 65</li>
                                </ul>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🏢 Mega Backdoor Roth</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• After-tax 401(k) contributions</li>
                                    <li>• Up to $69,000 total annual limit</li>
                                    <li>• Requires employer plan support</li>
                                    <li>• Convert to Roth immediately</li>
                                </ul>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-indigo-600">Early Retirement Access Strategies</h3>
                        <div class="space-y-4 mb-6">
                            <div class="border-l-4 border-indigo-500 pl-4">
                                <h4 class="font-semibold text-gray-800">Roth IRA Ladder</h4>
                                <p class="text-sm text-gray-600 mt-1">Convert Traditional IRA to Roth annually, wait 5 years, then access penalty-free.</p>
                            </div>
                            <div class="border-l-4 border-blue-500 pl-4">
                                <h4 class="font-semibold text-gray-800">Rule of 55</h4>
                                <p class="text-sm text-gray-600 mt-1">Access 401(k) penalty-free if you leave your job at age 55 or later.</p>
                            </div>
                            <div class="border-l-4 border-green-500 pl-4">
                                <h4 class="font-semibold text-gray-800">SEPP (72t)</h4>
                                <p class="text-sm text-gray-600 mt-1">Substantially Equal Periodic Payments from retirement accounts before age 59½.</p>
                            </div>
                        </div>

                        <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4">
                            <h4 class="font-semibold text-indigo-800 mb-2">💡 Key Takeaway</h4>
                            <p class="text-sm text-indigo-700">The order matters! Maximize tax-advantaged accounts first, then use taxable accounts for FIRE bridge years. Consider working with a tax professional for complex strategies.</p>
                        </div>
                    `
                },
                {
                    id: 'stocks-guide',
                    icon: 'chart-line',
                    title: 'Understanding Stocks & Individual Securities',
                    content: `
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl mb-6 border border-blue-200">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">What Are Stocks?</h3>
                            <p class="text-gray-600">Stocks represent ownership shares in a company. When you buy stock, you become a partial owner of that company and have a claim on its assets and earnings.</p>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-blue-600">Types of Stocks</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">📊 Common Stock</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Voting rights on company matters</li>
                                    <li>• Potential for dividends</li>
                                    <li>• Higher risk, higher potential reward</li>
                                    <li>• Most stocks are common stock</li>
                                </ul>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🏦 Preferred Stock</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Fixed dividend payments</li>
                                    <li>• Priority over common stock</li>
                                    <li>• Usually no voting rights</li>
                                    <li>• More stable, bond-like returns</li>
                                </ul>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-blue-600">Key Stock Metrics</h3>
                        <div class="space-y-4 mb-6">
                            <div class="border border-blue-200 rounded-lg p-4 bg-blue-50">
                                <h4 class="font-semibold text-gray-800 mb-2">📈 Price-to-Earnings (P/E) Ratio</h4>
                                <p class="text-sm text-gray-600 mb-2">Measures how much investors are willing to pay per dollar of earnings.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Formula:</strong> Stock Price ÷ Earnings Per Share<br>
                                    <strong>Example:</strong> $100 stock price ÷ $5 EPS = 20 P/E ratio
                                </div>
                            </div>
                            <div class="border border-green-200 rounded-lg p-4 bg-green-50">
                                <h4 class="font-semibold text-gray-800 mb-2">💰 Market Capitalization</h4>
                                <p class="text-sm text-gray-600 mb-2">Total value of all company shares outstanding.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Large Cap:</strong> $10B+<br>
                                    <strong>Mid Cap:</strong> $2B-$10B<br>
                                    <strong>Small Cap:</strong> $300M-$2B
                                </div>
                            </div>
                            <div class="border border-purple-200 rounded-lg p-4 bg-purple-50">
                                <h4 class="font-semibold text-gray-800 mb-2">📊 Beta</h4>
                                <p class="text-sm text-gray-600 mb-2">Measures volatility compared to the overall market.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Beta = 1:</strong> Moves with market<br>
                                    <strong>Beta > 1:</strong> More volatile than market<br>
                                    <strong>Beta < 1:</strong> Less volatile than market
                                </div>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-blue-600">Stock Analysis Methods</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🔍 Fundamental Analysis</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Company financial statements</li>
                                    <li>• Revenue and profit trends</li>
                                    <li>• Industry and economic factors</li>
                                    <li>• Management quality</li>
                                </ul>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">📉 Technical Analysis</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Price charts and patterns</li>
                                    <li>• Trading volume analysis</li>
                                    <li>• Moving averages and trends</li>
                                    <li>• Support and resistance levels</li>
                                </ul>
                            </div>
                        </div>

                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-800 mb-2">💡 Stock Investing Tips</h4>
                            <ul class="text-sm text-blue-700 space-y-1 list-disc list-inside">
                                <li>Diversify across different sectors and company sizes</li>
                                <li>Focus on companies with strong competitive advantages</li>
                                <li>Consider dividend-paying stocks for income</li>
                                <li>Don't try to time the market - use dollar-cost averaging</li>
                                <li>Research before investing - understand what you own</li>
                            </ul>
                        </div>
                    `
                },
                {
                    id: 'etfs-guide',
                    icon: 'layer-group',
                    title: 'ETFs: Exchange-Traded Funds Explained',
                    content: `
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-xl mb-6 border border-green-200">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">What Are ETFs?</h3>
                            <p class="text-gray-600">ETFs are investment funds that trade on stock exchanges like individual stocks. They typically track an index, commodity, bonds, or a basket of assets.</p>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-green-600">Popular ETF Categories</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🏛️ Broad Market ETFs</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• <strong>SPY:</strong> S&P 500 index</li>
                                    <li>• <strong>VTI:</strong> Total US stock market</li>
                                    <li>• <strong>QQQ:</strong> NASDAQ 100</li>
                                    <li>• <strong>VEA:</strong> Developed markets</li>
                                </ul>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🏢 Sector ETFs</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• <strong>XLK:</strong> Technology sector</li>
                                    <li>• <strong>XLF:</strong> Financial sector</li>
                                    <li>• <strong>XLE:</strong> Energy sector</li>
                                    <li>• <strong>XLV:</strong> Healthcare sector</li>
                                </ul>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🏦 Bond ETFs</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• <strong>BND:</strong> Total bond market</li>
                                    <li>• <strong>AGG:</strong> US aggregate bonds</li>
                                    <li>• <strong>TLT:</strong> Long-term treasury</li>
                                    <li>• <strong>HYG:</strong> High-yield bonds</li>
                                </ul>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🏗️ Specialty ETFs</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• <strong>VNQ:</strong> Real Estate (REITs)</li>
                                    <li>• <strong>GLD:</strong> Gold commodity</li>
                                    <li>• <strong>VWO:</strong> Emerging markets</li>
                                    <li>• <strong>ARKK:</strong> Innovation/Tech</li>
                                </ul>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-green-600">ETF Advantages</h3>
                        <div class="space-y-4 mb-6">
                            <div class="border border-green-200 rounded-lg p-4 bg-green-50">
                                <h4 class="font-semibold text-gray-800 mb-2">📊 Instant Diversification</h4>
                                <p class="text-sm text-gray-600 mb-2">Own hundreds or thousands of stocks with a single purchase.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Example:</strong> VTI holds over 4,000 US stocks across all sectors and sizes
                                </div>
                            </div>
                            <div class="border border-blue-200 rounded-lg p-4 bg-blue-50">
                                <h4 class="font-semibold text-gray-800 mb-2">💰 Low Costs</h4>
                                <p class="text-sm text-gray-600 mb-2">Lower expense ratios compared to mutual funds.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Typical Range:</strong> 0.03% - 0.75% annually<br>
                                    <strong>Example:</strong> 0.03% on $10,000 = $3/year in fees
                                </div>
                            </div>
                            <div class="border border-purple-200 rounded-lg p-4 bg-purple-50">
                                <h4 class="font-semibold text-gray-800 mb-2">⚡ Liquidity & Flexibility</h4>
                                <p class="text-sm text-gray-600 mb-2">Trade during market hours like stocks.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Benefits:</strong> Real-time pricing, limit orders, stop losses
                                </div>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-green-600">Building an ETF Portfolio</h3>
                        <div class="bg-white border border-gray-200 rounded-lg p-6 mb-6 shadow-sm">
                            <h4 class="font-semibold text-gray-800 mb-3">🎯 Sample Conservative Portfolio</h4>
                            <div class="space-y-3 text-sm">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">US Total Market (VTI):</span>
                                    <span class="font-medium text-gray-800">60%</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">International Developed (VEA):</span>
                                    <span class="font-medium text-gray-800">20%</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Bonds (BND):</span>
                                    <span class="font-medium text-gray-800">15%</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Real Estate (VNQ):</span>
                                    <span class="font-medium text-gray-800">5%</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h4 class="font-semibold text-green-800 mb-2">✅ ETF Best Practices</h4>
                            <ul class="text-sm text-green-700 space-y-1 list-disc list-inside">
                                <li>Start with broad market ETFs for core holdings</li>
                                <li>Check expense ratios - lower is usually better</li>
                                <li>Consider tax efficiency - ETFs are generally tax-friendly</li>
                                <li>Rebalance periodically to maintain target allocation</li>
                                <li>Avoid over-diversification - a few broad ETFs can be enough</li>
                            </ul>
                        </div>
                    `
                },
                {
                    id: 'market-indices',
                    icon: 'chart-area',
                    title: 'Market Indices: Understanding the Benchmarks',
                    content: `
                        <div class="bg-gradient-to-r from-purple-50 to-indigo-50 p-6 rounded-xl mb-6 border border-purple-200">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">What Are Market Indices?</h3>
                            <p class="text-gray-600">Market indices are statistical measures that track the performance of a specific group of stocks, representing a particular market segment or the overall market.</p>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-purple-600">Major US Indices</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">📊 S&P 500 (^GSPC)</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• 500 largest US companies</li>
                                    <li>• Market cap weighted</li>
                                    <li>• Covers ~80% of US stock market</li>
                                    <li>• Most popular benchmark</li>
                                </ul>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🏭 Dow Jones (^DJI)</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• 30 large blue-chip companies</li>
                                    <li>• Price-weighted index</li>
                                    <li>• Oldest US stock index (1896)</li>
                                    <li>• More narrow representation</li>
                                </ul>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">💻 NASDAQ Composite (^IXIC)</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• All NASDAQ-listed stocks</li>
                                    <li>• Tech-heavy concentration</li>
                                    <li>• Over 3,000 companies</li>
                                    <li>• Growth-oriented benchmark</li>
                                </ul>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🏘️ Russell 2000 (^RUT)</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• 2,000 small-cap companies</li>
                                    <li>• $300M - $2B market cap</li>
                                    <li>• Small company performance</li>
                                    <li>• Higher volatility</li>
                                </ul>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-purple-600">International Indices</h3>
                        <div class="space-y-4 mb-6">
                            <div class="border border-purple-200 rounded-lg p-4 bg-purple-50">
                                <h4 class="font-semibold text-gray-800 mb-2">🌍 MSCI World Index</h4>
                                <p class="text-sm text-gray-600 mb-2">Tracks large and mid-cap stocks across 23 developed countries.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Countries:</strong> US, UK, Japan, Germany, France, Canada, Australia, and more
                                </div>
                            </div>
                            <div class="border border-green-200 rounded-lg p-4 bg-green-50">
                                <h4 class="font-semibold text-gray-800 mb-2">🏯 Nikkei 225 (Japan)</h4>
                                <p class="text-sm text-gray-600 mb-2">225 large companies listed on Tokyo Stock Exchange.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Notable:</strong> Toyota, Sony, SoftBank, Nintendo
                                </div>
                            </div>
                            <div class="border border-blue-200 rounded-lg p-4 bg-blue-50">
                                <h4 class="font-semibold text-gray-800 mb-2">🇪🇺 Euro Stoxx 50</h4>
                                <p class="text-sm text-gray-600 mb-2">50 largest companies in the Eurozone.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Countries:</strong> Germany, France, Netherlands, Italy, Spain, Belgium
                                </div>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-purple-600">Specialty Indices</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">😰 VIX - Volatility Index</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Measures market fear/volatility</li>
                                    <li>• Based on S&P 500 options</li>
                                    <li>• "Fear gauge" of the market</li>
                                    <li>• High VIX = High uncertainty</li>
                                </ul>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🏠 REIT Indices</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Real Estate Investment Trusts</li>
                                    <li>• Property-focused investments</li>
                                    <li>• Income-generating assets</li>
                                    <li>• Inflation hedge potential</li>
                                </ul>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-purple-600">Index Weighting Methods</h3>
                        <div class="space-y-4 mb-6">
                            <div class="border border-purple-200 rounded-lg p-4 bg-purple-50">
                                <h4 class="font-semibold text-gray-800 mb-2">⚖️ Market Cap Weighted</h4>
                                <p class="text-sm text-gray-600 mb-2">Largest companies have the biggest impact on index performance.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Example:</strong> Apple's weight in S&P 500 is proportional to its market cap
                                </div>
                            </div>
                            <div class="border border-blue-200 rounded-lg p-4 bg-blue-50">
                                <h4 class="font-semibold text-gray-800 mb-2">💰 Price Weighted</h4>
                                <p class="text-sm text-gray-600 mb-2">Companies with higher stock prices have more influence.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Example:</strong> Dow Jones - a $300 stock has 3x impact of a $100 stock
                                </div>
                            </div>
                            <div class="border border-green-200 rounded-lg p-4 bg-green-50">
                                <h4 class="font-semibold text-gray-800 mb-2">🎯 Equal Weighted</h4>
                                <p class="text-sm text-gray-600 mb-2">All companies have the same weight regardless of size.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Effect:</strong> Gives more influence to smaller companies
                                </div>
                            </div>
                        </div>

                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <h4 class="font-semibold text-purple-800 mb-2">📈 Why Indices Matter</h4>
                            <ul class="text-sm text-purple-700 space-y-1 list-disc list-inside">
                                <li>Benchmarks for measuring investment performance</li>
                                <li>Basis for index funds and ETFs</li>
                                <li>Economic indicators and market sentiment</li>
                                <li>Diversification tools for investors</li>
                                <li>Historical data for backtesting strategies</li>
                            </ul>
                        </div>
                    `
                },
                {
                    id: 'market-terminology',
                    icon: 'book-open',
                    title: 'Market Terminology: Bull, Bear & Beyond',
                    content: `
                        <div class="bg-gradient-to-r from-yellow-50 to-orange-50 p-6 rounded-xl mb-6 border border-yellow-200">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">Essential Market Terms</h3>
                            <p class="text-gray-600">Understanding market terminology is crucial for making informed investment decisions and communicating with other investors.</p>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-yellow-600">Market Trends & Sentiment</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🐂 Bull Market</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Rising prices over extended period</li>
                                    <li>• Investor confidence high</li>
                                    <li>• 20%+ gain from recent lows</li>
                                    <li>• Strong economic growth</li>
                                </ul>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🐻 Bear Market</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Declining prices over extended period</li>
                                    <li>• Investor pessimism high</li>
                                    <li>• 20%+ decline from recent highs</li>
                                    <li>• Economic uncertainty</li>
                                </ul>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🦘 Kangaroo Market</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Sideways movement</li>
                                    <li>• Frequent ups and downs</li>
                                    <li>• No clear trend direction</li>
                                    <li>• Range-bound trading</li>
                                </ul>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">📈 Correction</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• 10-20% decline from highs</li>
                                    <li>• Temporary pullback</li>
                                    <li>• Healthy market reset</li>
                                    <li>• Often buying opportunity</li>
                                </ul>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-yellow-600">Trading & Investment Terms</h3>
                        <div class="space-y-4 mb-6">
                            <div class="border border-yellow-200 rounded-lg p-4 bg-yellow-50">
                                <h4 class="font-semibold text-gray-800 mb-2">💹 Volatility</h4>
                                <p class="text-sm text-gray-600 mb-2">Measure of price fluctuation over time.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>High Vol:</strong> Large price swings<br>
                                    <strong>Low Vol:</strong> Stable price movements
                                </div>
                            </div>
                            <div class="border border-blue-200 rounded-lg p-4 bg-blue-50">
                                <h4 class="font-semibold text-gray-800 mb-2">📊 Liquidity</h4>
                                <p class="text-sm text-gray-600 mb-2">How easily an asset can be bought or sold.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>High Liquidity:</strong> Easy to trade, tight spreads<br>
                                    <strong>Low Liquidity:</strong> Harder to trade, wide spreads
                                </div>
                            </div>
                            <div class="border border-green-200 rounded-lg p-4 bg-green-50">
                                <h4 class="font-semibold text-gray-800 mb-2">🎯 Bid-Ask Spread</h4>
                                <p class="text-sm text-gray-600 mb-2">Difference between buying and selling price.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Bid:</strong> Highest price buyers will pay<br>
                                    <strong>Ask:</strong> Lowest price sellers will accept
                                </div>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-yellow-600">Behavioral Finance Terms</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">😱 FOMO</h4>
                                <p class="text-sm text-gray-600 mb-2">Fear of Missing Out</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    Rushing into investments due to fear of missing gains
                                </div>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">💎 Diamond Hands</h4>
                                <p class="text-sm text-gray-600 mb-2">Holding despite volatility</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    Not selling during market downturns
                                </div>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">📜 Paper Hands</h4>
                                <p class="text-sm text-gray-600 mb-2">Selling too quickly</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    Selling at first sign of trouble
                                </div>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🚀 To The Moon</h4>
                                <p class="text-sm text-gray-600 mb-2">Expecting huge gains</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    Belief that price will skyrocket
                                </div>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-yellow-600">Risk & Portfolio Terms</h3>
                        <div class="space-y-4 mb-6">
                            <div class="border border-red-200 rounded-lg p-4 bg-red-50">
                                <h4 class="font-semibold text-gray-800 mb-2">⚠️ Risk Tolerance</h4>
                                <p class="text-sm text-gray-600 mb-2">How much risk you can handle emotionally and financially.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Conservative:</strong> Low risk, lower returns<br>
                                    <strong>Aggressive:</strong> High risk, higher potential returns
                                </div>
                            </div>
                            <div class="border border-blue-200 rounded-lg p-4 bg-blue-50">
                                <h4 class="font-semibold text-gray-800 mb-2">🎯 Asset Allocation</h4>
                                <p class="text-sm text-gray-600 mb-2">How you divide investments across different asset classes.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Example:</strong> 60% stocks, 30% bonds, 10% real estate
                                </div>
                            </div>
                            <div class="border border-green-200 rounded-lg p-4 bg-green-50">
                                <h4 class="font-semibold text-gray-800 mb-2">🔄 Rebalancing</h4>
                                <p class="text-sm text-gray-600 mb-2">Adjusting portfolio back to target allocation.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Why:</strong> Market movements change your allocation over time
                                </div>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-yellow-600">Economic Indicators</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">📈 GDP Growth</h4>
                                <p class="text-sm text-gray-600">Gross Domestic Product - measures economic output</p>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">💰 Inflation Rate</h4>
                                <p class="text-sm text-gray-600">Rate at which prices for goods and services rise</p>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🏦 Interest Rates</h4>
                                <p class="text-sm text-gray-600">Federal Reserve's benchmark rates</p>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">👥 Employment Data</h4>
                                <p class="text-sm text-gray-600">Unemployment rate and job creation numbers</p>
                            </div>
                        </div>

                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <h4 class="font-semibold text-yellow-800 mb-2">📚 Quick Reference</h4>
                            <div class="text-sm text-yellow-700 space-y-1">
                                <p><strong>DCA:</strong> Dollar-Cost Averaging - investing fixed amounts regularly</p>
                                <p><strong>HODL:</strong> Hold On for Dear Life - long-term holding strategy</p>
                                <p><strong>DD:</strong> Due Diligence - researching before investing</p>
                                <p><strong>YOLO:</strong> You Only Live Once - high-risk investment approach</p>
                                <p><strong>Bag Holder:</strong> Someone holding a losing investment</p>
                            </div>
                        </div>
                    `
                },
                {
                    id: 'side-hustles',
                    icon: 'rocket',
                    title: 'Side Hustles & Income Optimization',
                    content: `
                        <div class="bg-gradient-to-r from-emerald-50 to-teal-50 p-6 rounded-xl mb-6 border border-emerald-200">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">Accelerate Your FIRE Journey</h3>
                            <p class="text-gray-600">Increasing your income is often more effective than cutting expenses. Side hustles can dramatically reduce your time to financial independence.</p>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-emerald-600">High-Impact Side Hustles</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">💻 Freelance Your Skills</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Writing, design, programming</li>
                                    <li>• Consulting in your expertise</li>
                                    <li>• $25-150+ per hour potential</li>
                                    <li>• Platforms: Upwork, Fiverr, Toptal</li>
                                </ul>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">📚 Online Course Creation</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Teach what you know</li>
                                    <li>• Passive income potential</li>
                                    <li>• $1,000-50,000+ per course</li>
                                    <li>• Platforms: Udemy, Teachable, Thinkific</li>
                                </ul>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🏠 Real Estate</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Rental property investment</li>
                                    <li>• House hacking (live in one unit)</li>
                                    <li>• REITs for passive exposure</li>
                                    <li>• 10-15% annual returns possible</li>
                                </ul>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-2">🛍️ E-commerce Business</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Amazon FBA, Shopify store</li>
                                    <li>• Dropshipping (low startup cost)</li>
                                    <li>• Print on demand products</li>
                                    <li>• Scalable with systems</li>
                                </ul>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-emerald-600">Income Optimization at Your Day Job</h3>
                        <div class="space-y-4 mb-6">
                            <div class="border border-emerald-200 rounded-lg p-4 bg-emerald-50">
                                <h4 class="font-semibold text-gray-800 mb-2">💰 Negotiate Your Salary</h4>
                                <p class="text-sm text-gray-600 mb-2">Research market rates and build a case for increase.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Strategy:</strong> Document achievements, show value added, timing matters
                                </div>
                            </div>

                            <div class="border border-blue-200 rounded-lg p-4 bg-blue-50">
                                <h4 class="font-semibold text-gray-800 mb-2">🎯 Focus on High-Value Skills</h4>
                                <p class="text-sm text-gray-600 mb-2">Invest in skills that directly impact company revenue.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Examples:</strong> Data analysis, sales, programming, project management
                                </div>
                            </div>

                            <div class="border border-purple-200 rounded-lg p-4 bg-purple-50">
                                <h4 class="font-semibold text-gray-800 mb-2">🏆 Side Projects at Work</h4>
                                <p class="text-sm text-gray-600 mb-2">Volunteer for high-visibility projects that showcase your impact.</p>
                                <div class="text-xs text-gray-600 bg-white p-2 rounded border">
                                    <strong>Result:</strong> Faster promotions, better reviews, networking opportunities
                                </div>
                            </div>
                        </div>

                        <h3 class="text-lg font-bold mt-6 mb-4 text-emerald-600">The FIRE Income Formula</h3>
                        <div class="bg-white border border-gray-200 rounded-lg p-6 mb-6 shadow-sm">
                            <h4 class="font-semibold text-gray-800 mb-3">📊 Calculate Your Income Impact</h4>
                            <div class="space-y-3 text-sm">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Extra $500/month side income:</span>
                                    <span class="font-medium text-gray-800">$6,000/year</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Invested at 7% for 10 years:</span>
                                    <span class="font-medium text-emerald-600">$82,844</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Time saved to FIRE:</span>
                                    <span class="font-medium text-emerald-600">2-4 years</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-4">
                            <h4 class="font-semibold text-emerald-800 mb-2">🚀 Action Steps</h4>
                            <ol class="text-sm text-emerald-700 space-y-1 list-decimal list-inside">
                                <li>Audit your current skills and time</li>
                                <li>Choose one side hustle to start this month</li>
                                <li>Set a realistic income goal ($500-2000/month)</li>
                                <li>Automate all side income directly to investments</li>
                                <li>Track your progress and scale what works</li>
                            </ol>
                        </div>
                    `
                }
            ];

            const ArticleCard = ({ article, onClick }) => {
                return React.createElement('div', {
                    className: 'card p-6 flex items-center gap-6 cursor-pointer hover:shadow-lg transition-all duration-300',
                    onClick: () => onClick(article)
                },
                    React.createElement('div', { className: 'p-4 bg-blue-100 rounded-xl flex items-center justify-center' },
                        React.createElement('i', { className: `fas fa-${article.icon} text-3xl text-blue-600` })
                    ),
                    React.createElement('div', null,
                        React.createElement('h3', { className: 'font-bold text-lg text-gray-800' }, article.title),
                        React.createElement('p', { className: 'text-gray-600 text-sm mt-1' }, 'Click to read more →')
                    )
                );
            };

            const Modal = ({ isOpen, onClose, children }) => {
                if (!isOpen) return null;

                return React.createElement('div', {
                    className: 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4',
                    onClick: onClose
                },
                    React.createElement('div', {
                        className: 'bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto',
                        onClick: (e) => e.stopPropagation()
                    },
                        React.createElement('div', { className: 'sticky top-0 bg-white border-b border-gray-200 p-6 flex justify-between items-center' },
                            React.createElement('h2', { className: 'text-xl font-bold text-gray-800' }, children?.props?.title || 'Guide'),
                            React.createElement('button', {
                                onClick: onClose,
                                className: 'text-gray-500 hover:text-gray-700 text-2xl font-bold'
                            }, '×')
                        ),
                        React.createElement('div', { className: 'p-6' }, children)
                    )
                );
            };

            const ArticleContent = ({ title, content }) => {
                return React.createElement('div', {
                    className: 'prose prose-gray max-w-none',
                    dangerouslySetInnerHTML: { __html: content }
                });
            };

            return React.createElement('div', { className: 'fade-in' },
                React.createElement('div', { className: 'mb-8' },
                    React.createElement('h2', { className: 'text-2xl font-bold text-gray-800 mb-4' }, 'Financial Independence Guides'),
                    React.createElement('p', { className: 'text-gray-600' }, 'Comprehensive guides to help you master financial independence. Click on any guide to learn more.')
                ),
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-6 mb-8' },
                    ...articles.map(article => React.createElement(ArticleCard, {
                        key: article.id,
                        article,
                        onClick: setSelectedArticle
                    }))
                ),
                React.createElement(Modal, {
                    isOpen: !!selectedArticle,
                    onClose: () => setSelectedArticle(null)
                },
                    selectedArticle && React.createElement(ArticleContent, {
                        title: selectedArticle.title,
                        content: selectedArticle.content
                    })
                )
            );
        }

        function MarketData() {
            const [marketData, setMarketData] = useState(() => loadCachedMarketData());
            const [selectedCategory, setSelectedCategory] = useState('indices');
            const [isLoading, setIsLoading] = useState(false);
            const [lastUpdated, setLastUpdated] = useState(null);
            const [isAutoRefresh, setIsAutoRefresh] = useState(true);
            const [refreshCount, setRefreshCount] = useState(0);
            const [searchQuery, setSearchQuery] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const [showSearchResults, setShowSearchResults] = useState(false);
            const [selectedStocks, setSelectedStocks] = useState([]);
            const intervalRef = useRef(null);

            // Auto-refresh when component is active
            useEffect(() => {
                const loadMarketData = async (forceRefresh = false) => {
                    if (!forceRefresh) setIsLoading(true);
                    try {
                        const symbols = selectedStocks.length > 0 ? selectedStocks.map(s => s.symbol) : [];
                        const data = await fetchMarketData(symbols, forceRefresh);
                        setMarketData(data);
                        setLastUpdated(new Date());
                        setRefreshCount(prev => prev + 1);
                    } catch (error) {
                        console.error('Failed to load market data:', error);
                    }
                    if (!forceRefresh) setIsLoading(false);
                };

                // Initial load
                loadMarketData();

                // Set up auto-refresh interval
                if (isAutoRefresh) {
                    intervalRef.current = setInterval(() => {
                        loadMarketData(true); // Force refresh for real-time updates
                    }, 60000); // 1 minute updates for real API calls
                }

                return () => {
                    if (intervalRef.current) {
                        clearInterval(intervalRef.current);
                    }
                };
            }, [isAutoRefresh, selectedStocks]);

            // Search functionality
            useEffect(() => {
                const performSearch = async () => {
                    if (searchQuery.length > 0) {
                        const results = await searchStocks(searchQuery);
                        setSearchResults(results);
                        setShowSearchResults(true);
                    } else {
                        setShowSearchResults(false);
                    }
                };

                const timeoutId = setTimeout(performSearch, 300);
                return () => clearTimeout(timeoutId);
            }, [searchQuery]);

            // Cleanup interval when component unmounts
            useEffect(() => {
                return () => {
                    if (intervalRef.current) {
                        clearInterval(intervalRef.current);
                    }
                };
            }, []);

            const handleSearchSelect = (stock) => {
                if (!selectedStocks.find(s => s.symbol === stock.symbol)) {
                    setSelectedStocks(prev => [...prev, stock]);
                }
                setSearchQuery('');
                setShowSearchResults(false);
            };

            const handleRemoveStock = (symbol) => {
                setSelectedStocks(prev => prev.filter(s => s.symbol !== symbol));
            };

            const categories = [
                { id: 'indices', label: 'Market Indices', icon: 'chart-line', tooltip: 'Major market indices like S&P 500, NASDAQ, Dow Jones' },
                { id: 'etfs', label: 'ETFs', icon: 'layer-group', tooltip: 'Exchange-traded funds for diversified investing' },
                { id: 'stocks', label: 'Popular Stocks', icon: 'building', tooltip: 'Individual company stocks and securities' },
                { id: 'custom', label: 'Custom Search', icon: 'search', tooltip: 'Search and track your own stocks' }
            ];

            const getTickersForCategory = (category) => {
                switch (category) {
                    case 'indices':
                        return MARKET_INDICES;
                    case 'etfs':
                        return MARKET_TICKERS.filter(t => ['SPY', 'VTI', 'QQQ', 'VEA', 'VWO', 'BND', 'VNQ', 'GLD'].includes(t.symbol));
                    case 'stocks':
                        return MARKET_TICKERS.filter(t => ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'TSLA', 'NVDA'].includes(t.symbol));
                    case 'custom':
                        return selectedStocks;
                    default:
                        return [];
                }
            };

            const StockSearch = () => {
                return React.createElement('div', { className: 'search-box mb-4' },
                    React.createElement('div', { className: 'relative' },
                        React.createElement('i', { className: 'fas fa-search search-icon' }),
                        React.createElement('input', {
                            type: 'text',
                            placeholder: 'Search stocks by symbol or name...',
                            value: searchQuery,
                            onChange: (e) => setSearchQuery(e.target.value),
                            className: 'search-input',
                            onFocus: () => setShowSearchResults(searchQuery.length > 0)
                        }),
                        showSearchResults && searchResults.length > 0 && React.createElement('div', { className: 'search-results' },
                            searchResults.map(stock =>
                                React.createElement('div', {
                                    key: stock.symbol,
                                    className: 'search-result',
                                    onClick: () => handleSearchSelect(stock)
                                },
                                    React.createElement('div', { className: 'flex justify-between items-center' },
                                        React.createElement('div', null,
                                            React.createElement('div', { className: 'font-medium' }, stock.symbol),
                                            React.createElement('div', { className: 'text-sm text-gray-500' }, stock.name)
                                        ),
                                        React.createElement('i', { className: 'fas fa-plus text-blue-500' })
                                    )
                                )
                            )
                        )
                    ),
                    selectedStocks.length > 0 && React.createElement('div', { className: 'mt-3' },
                        React.createElement('div', { className: 'flex flex-wrap gap-2' },
                            selectedStocks.map(stock =>
                                React.createElement('div', {
                                    key: stock.symbol,
                                    className: 'flex items-center gap-2 bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm'
                                },
                                    React.createElement('span', null, stock.symbol),
                                    React.createElement('button', {
                                        onClick: () => handleRemoveStock(stock.symbol),
                                        className: 'text-blue-600 hover:text-blue-800'
                                    }, '×')
                                )
                            )
                        )
                    )
                );
            };

            const StockCard = ({ ticker, data }) => {
                if (!data) return null;

                const isPositive = parseFloat(data.change) >= 0;
                const changeClass = isPositive ? 'price-positive' : 'price-negative';
                const cardClass = isPositive ? 'positive' : 'negative';

                // Create mini chart using Chart.js
                const chartRef = useRef(null);
                const chartInstance = useRef(null);

                useEffect(() => {
                    if (chartRef.current && data.priceHistory) {
                        const ctx = chartRef.current.getContext('2d');

                        // Destroy existing chart
                        if (chartInstance.current) {
                            chartInstance.current.destroy();
                        }

                        // Create new chart
                        chartInstance.current = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: data.priceHistory.map((_, i) => i),
                                datasets: [{
                                    data: data.priceHistory,
                                    borderColor: isPositive ? '#10b981' : '#ef4444',
                                    backgroundColor: isPositive ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)',
                                    borderWidth: 2,
                                    fill: true,
                                    pointRadius: 0,
                                    pointHoverRadius: 0,
                                    tension: 0.3
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: { display: false },
                                    tooltip: { enabled: false }
                                },
                                scales: {
                                    x: { display: false },
                                    y: { display: false }
                                },
                                animation: {
                                    duration: 0
                                },
                                interaction: {
                                    intersect: false
                                }
                            }
                        });
                    }

                    return () => {
                        if (chartInstance.current) {
                            chartInstance.current.destroy();
                        }
                    };
                }, [data.priceHistory, isPositive]);

                return React.createElement('div', {
                    className: `market-card ${cardClass}`,
                    'data-symbol': ticker.symbol
                },
                    React.createElement('div', { className: 'flex justify-between items-start mb-3' },
                        React.createElement('div', null,
                            React.createElement('div', { className: 'flex items-center gap-2' },
                                React.createElement('h3', { className: 'font-bold text-lg text-gray-800' }, ticker.symbol),
                                React.createElement('div', { className: 'tooltip' },
                                    React.createElement('i', { className: 'fas fa-info-circle text-gray-400 text-sm cursor-help' }),
                                    React.createElement('div', { className: 'tooltip-content' },
                                        `${data.sector} • ${data.industry} • P/E: ${data.pe} • Beta: ${data.beta}`
                                    )
                                )
                            ),
                            React.createElement('p', { className: 'text-sm text-gray-600 truncate' }, ticker.name),
                            React.createElement('div', { className: 'flex items-center gap-2 mt-1' },
                                React.createElement('span', { className: 'text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded' }, data.sector),
                                React.createElement('span', { className: `text-xs px-2 py-1 rounded ${data.analystRating === 'Strong Buy' || data.analystRating === 'Buy' ? 'bg-green-100 text-green-700' : data.analystRating === 'Hold' ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700'}` },
                                    data.analystRating
                                )
                            )
                        ),
                        React.createElement('div', { className: 'text-right' },
                            React.createElement('div', { className: 'font-bold text-xl text-gray-800' }, `$${data.price}`),
                            React.createElement('div', { className: `text-sm font-medium ${changeClass}` },
                                `${isPositive ? '+' : ''}${data.change} (${isPositive ? '+' : ''}${data.changePercent}%)`
                            )
                        )
                    ),
                    React.createElement('div', { className: 'chart-mini mb-3' },
                        React.createElement('canvas', { ref: chartRef })
                    ),
                    React.createElement('div', { className: 'grid grid-cols-2 gap-2 text-xs text-gray-500' },
                        React.createElement('div', { className: 'tooltip' },
                            React.createElement('span', null, `Vol: ${((data.volume || 0) / 1000000).toFixed(1)}M`),
                            React.createElement('div', { className: 'tooltip-content' },
                                `Volume: ${(data.volume || 0).toLocaleString()} • Avg Vol: ${(data.avgVolume || 0).toLocaleString()}`
                            )
                        ),
                        React.createElement('div', { className: 'tooltip' },
                            React.createElement('span', null, `MCap: $${(data.marketCap / 1000000000).toFixed(1)}B`),
                            React.createElement('div', { className: 'tooltip-content' },
                                `Market Cap: $${(data.marketCap / 1000000000).toFixed(2)}B`
                            )
                        ),
                        data.dayHigh && React.createElement('div', { className: 'tooltip' },
                            React.createElement('span', null, `High: $${data.dayHigh}`),
                            React.createElement('div', { className: 'tooltip-content' },
                                `Day Range: $${data.dayLow} - $${data.dayHigh}`
                            )
                        ),
                        data.dividend && parseFloat(data.dividend) > 0 && React.createElement('div', { className: 'tooltip' },
                            React.createElement('span', null, `Div: ${data.dividend}%`),
                            React.createElement('div', { className: 'tooltip-content' },
                                `Dividend Yield: ${data.dividend}%`
                            )
                        )
                    ),
                    React.createElement('div', { className: 'mt-3 pt-3 border-t border-gray-100' },
                        React.createElement('div', { className: 'flex justify-between items-center text-xs' },
                            React.createElement('div', { className: 'flex items-center gap-3' },
                                React.createElement('div', { className: 'tooltip' },
                                    React.createElement('span', { className: 'font-medium' }, `RSI: ${data.rsi}`),
                                    React.createElement('div', { className: 'tooltip-content' },
                                        `RSI: ${data.rsi} • ${data.rsi > 70 ? 'Overbought' : data.rsi < 30 ? 'Oversold' : 'Normal'}`
                                    )
                                ),
                                React.createElement('div', { className: 'tooltip' },
                                    React.createElement('span', { className: 'font-medium' }, `P/E: ${data.pe}`),
                                    React.createElement('div', { className: 'tooltip-content' },
                                        `Price-to-Earnings Ratio: ${data.pe}`
                                    )
                                )
                            ),
                            React.createElement('div', { className: 'text-right' },
                                React.createElement('div', { className: 'tooltip' },
                                    React.createElement('span', { className: `font-medium ${parseFloat(data.epsGrowth) >= 0 ? 'text-green-600' : 'text-red-600'}` },
                                        `EPS: ${parseFloat(data.epsGrowth) >= 0 ? '+' : ''}${data.epsGrowth}%`
                                    ),
                                    React.createElement('div', { className: 'tooltip-content' },
                                        `EPS Growth: ${data.epsGrowth}% • Revenue Growth: ${data.revenueGrowth}%`
                                    )
                                )
                            )
                        )
                    )
                );
            };

            const MarketSummary = () => {
                const summaryData = getTickersForCategory('indices').map(index => ({
                    ...index,
                    data: marketData[index.symbol]
                })).filter(item => item.data);

                return React.createElement('div', { className: 'card p-6 mb-6' },
                    React.createElement('h3', { className: 'text-lg font-semibold mb-4 flex items-center gap-2' },
                        React.createElement('i', { className: 'fas fa-chart-area text-primary' }),
                        'Market Overview',
                        React.createElement('span', {
                            className: `ml-2 px-2 py-1 text-xs rounded-full ${isAutoRefresh ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'}`
                        },
                            isAutoRefresh ? '🔴 LIVE' : 'PAUSED'
                        )
                    ),
                    React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-5 gap-4' },
                        ...summaryData.map(item => {
                            const isPositive = parseFloat(item.data.change) >= 0;
                            const changeClass = isPositive ? 'text-green-600' : 'text-red-600';

                            return React.createElement('div', { key: item.symbol, className: 'text-center' },
                                React.createElement('div', { className: 'font-medium text-gray-800 text-sm' }, item.displayName),
                                React.createElement('div', { className: 'font-bold text-lg' }, `$${item.data.price}`),
                                React.createElement('div', { className: `text-xs ${changeClass}` },
                                    `${isPositive ? '+' : ''}${item.data.changePercent}%`
                                )
                            );
                        })
                    ),
                    React.createElement('div', { className: 'flex justify-between items-center mt-4 text-xs text-gray-500' },
                        React.createElement('span', null,
                            lastUpdated ? `Last updated: ${lastUpdated.toLocaleTimeString()}` : 'Loading...'
                        ),
                        React.createElement('span', null, `Updates: ${refreshCount}`)
                    )
                );
            };

            const MarketTrends = () => {
                const allData = Object.values(marketData).filter(data => data && data.changePercent);
                if (allData.length === 0) return null;

                const positive = allData.filter(data => parseFloat(data.change) >= 0);
                const negative = allData.filter(data => parseFloat(data.change) < 0);
                const positivePercent = (positive.length / allData.length) * 100;

                const avgChange = allData.reduce((sum, data) => sum + parseFloat(data.changePercent), 0) / allData.length;
                const strongMovers = allData.filter(data => Math.abs(parseFloat(data.changePercent)) > 2);

                return React.createElement('div', { className: 'card p-6 mb-6' },
                    React.createElement('h3', { className: 'text-lg font-semibold mb-4 flex items-center gap-2' },
                        React.createElement('i', { className: 'fas fa-trending-up text-primary' }),
                        'Market Trends & Analytics'
                    ),
                    React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-4' },
                        React.createElement('div', { className: 'text-center p-4 bg-gray-50 rounded-lg' },
                            React.createElement('div', { className: 'text-2xl font-bold text-green-600' }, `${positive.length}`),
                            React.createElement('div', { className: 'text-sm text-gray-600' }, 'Advancing'),
                            React.createElement('div', { className: 'text-xs text-gray-500' }, `${positivePercent.toFixed(1)}%`)
                        ),
                        React.createElement('div', { className: 'text-center p-4 bg-gray-50 rounded-lg' },
                            React.createElement('div', { className: 'text-2xl font-bold text-red-600' }, `${negative.length}`),
                            React.createElement('div', { className: 'text-sm text-gray-600' }, 'Declining'),
                            React.createElement('div', { className: 'text-xs text-gray-500' }, `${(100 - positivePercent).toFixed(1)}%`)
                        ),
                        React.createElement('div', { className: 'text-center p-4 bg-gray-50 rounded-lg' },
                            React.createElement('div', { className: `text-2xl font-bold ${avgChange >= 0 ? 'text-green-600' : 'text-red-600'}` },
                                `${avgChange >= 0 ? '+' : ''}${avgChange.toFixed(2)}%`
                            ),
                            React.createElement('div', { className: 'text-sm text-gray-600' }, 'Avg Change'),
                            React.createElement('div', { className: 'text-xs text-gray-500' }, 'Market Wide')
                        ),
                        React.createElement('div', { className: 'text-center p-4 bg-gray-50 rounded-lg' },
                            React.createElement('div', { className: 'text-2xl font-bold text-blue-600' }, `${strongMovers.length}`),
                            React.createElement('div', { className: 'text-sm text-gray-600' }, 'Strong Movers'),
                            React.createElement('div', { className: 'text-xs text-gray-500' }, '>2% change')
                        )
                    ),
                    React.createElement('div', { className: 'mt-4' },
                        React.createElement('div', { className: 'flex items-center gap-2 mb-2' },
                            React.createElement('span', { className: 'text-sm font-medium' }, 'Market Sentiment:'),
                            React.createElement('div', { className: 'flex-1 bg-gray-200 rounded-full h-2' },
                                React.createElement('div', {
                                    className: 'bg-green-500 h-2 rounded-full transition-all duration-500',
                                    style: { width: `${positivePercent}%` }
                                })
                            ),
                            React.createElement('span', { className: 'text-sm text-gray-600' }, `${positivePercent.toFixed(0)}% bullish`)
                        )
                    )
                );
            };

            const MarketHeatMap = () => {
                const allTickers = [...MARKET_TICKERS, ...MARKET_INDICES];
                const tickersWithData = allTickers.map(ticker => ({
                    ...ticker,
                    data: marketData[ticker.symbol]
                })).filter(item => item.data);

                if (tickersWithData.length === 0) return null;

                const getHeatClass = (changePercent) => {
                    const change = parseFloat(changePercent);
                    if (change > 2) return 'heat-positive-strong';
                    if (change > 0.5) return 'heat-positive-medium';
                    if (change > 0) return 'heat-positive-weak';
                    if (change < -2) return 'heat-negative-strong';
                    if (change < -0.5) return 'heat-negative-medium';
                    if (change < 0) return 'heat-negative-weak';
                    return 'heat-neutral';
                };

                return React.createElement('div', { className: 'card p-6 mb-6' },
                    React.createElement('h3', { className: 'text-lg font-semibold mb-4 flex items-center gap-2' },
                        React.createElement('i', { className: 'fas fa-th text-primary' }),
                        'Market Heat Map'
                    ),
                    React.createElement('div', { className: 'market-heat-map' },
                        tickersWithData.map(item =>
                            React.createElement('div', {
                                key: item.symbol,
                                className: `heat-cell ${getHeatClass(item.data.changePercent)}`,
                                title: `${item.symbol}: ${item.data.changePercent}% (${item.data.change})`
                            }, item.symbol)
                        )
                    ),
                    React.createElement('div', { className: 'flex justify-between items-center mt-4 text-xs text-gray-500' },
                        React.createElement('div', { className: 'flex items-center space-x-4' },
                            React.createElement('div', { className: 'flex items-center space-x-1' },
                                React.createElement('div', { className: 'w-3 h-3 bg-green-500 rounded' }),
                                React.createElement('span', null, 'Positive')
                            ),
                            React.createElement('div', { className: 'flex items-center space-x-1' },
                                React.createElement('div', { className: 'w-3 h-3 bg-red-500 rounded' }),
                                React.createElement('span', null, 'Negative')
                            ),
                            React.createElement('div', { className: 'flex items-center space-x-1' },
                                React.createElement('div', { className: 'w-3 h-3 bg-gray-400 rounded' }),
                                React.createElement('span', null, 'Neutral')
                            )
                        ),
                        React.createElement('span', null, `${tickersWithData.length} assets tracked`)
                    )
                );
            };

            const SessionAnalytics = () => {
                const analytics = getSessionAnalytics();

                return React.createElement('div', { className: 'card p-4 mb-4 bg-gradient-to-r from-blue-50 to-purple-50' },
                    React.createElement('div', { className: 'flex items-center justify-between' },
                        React.createElement('div', { className: 'flex items-center gap-3' },
                            React.createElement('div', { className: 'w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center' },
                                React.createElement('i', { className: 'fas fa-chart-bar text-white text-sm' })
                            ),
                            React.createElement('div', null,
                                React.createElement('h4', { className: 'font-medium text-gray-800' }, 'Session Analytics'),
                                React.createElement('p', { className: 'text-xs text-gray-600' }, 'Your usage statistics')
                            )
                        ),
                        React.createElement('div', { className: 'flex items-center gap-4 text-xs' },
                            React.createElement('div', { className: 'text-center' },
                                React.createElement('div', { className: 'font-bold text-blue-600' }, analytics.totalSessions),
                                React.createElement('div', { className: 'text-gray-600' }, 'Sessions')
                            ),
                            React.createElement('div', { className: 'text-center' },
                                React.createElement('div', { className: 'font-bold text-green-600' }, analytics.marketDataUpdates),
                                React.createElement('div', { className: 'text-gray-600' }, 'Updates')
                            ),
                            React.createElement('div', { className: 'text-center' },
                                React.createElement('div', { className: 'font-bold text-purple-600' }, analytics.calculatorUsage.totalCalculations),
                                React.createElement('div', { className: 'text-gray-600' }, 'Calculations')
                            )
                        )
                    )
                );
            };

            return React.createElement('div', { className: 'fade-in' },
                React.createElement(SessionAnalytics),
                React.createElement(MarketSummary),
                React.createElement(MarketTrends),
                React.createElement(MarketHeatMap),
                React.createElement('div', { className: 'card p-6 mb-6' },
                    React.createElement('div', { className: 'flex justify-between items-center mb-6' },
                        React.createElement('h3', { className: 'text-lg font-semibold flex items-center gap-2' },
                            React.createElement('i', { className: 'fas fa-chart-line text-primary' }),
                            'Market Data'
                        ),
                        React.createElement('div', { className: 'flex items-center gap-2' },
                            React.createElement('button', {
                                onClick: () => setIsAutoRefresh(!isAutoRefresh),
                                className: `btn text-sm px-3 py-1 ${isAutoRefresh ? 'bg-red-500 text-white hover:bg-red-600' : 'bg-green-500 text-white hover:bg-green-600'}`
                            },
                                React.createElement('i', { className: `fas fa-${isAutoRefresh ? 'pause' : 'play'}` }),
                                ` ${isAutoRefresh ? 'Pause' : 'Resume'}`
                            ),
                            React.createElement('button', {
                                onClick: () => {
                                    setIsLoading(true);
                                    fetchMarketData([], true).then(data => {
                                        setMarketData(data);
                                        setLastUpdated(new Date());
                                        setRefreshCount(prev => prev + 1);
                                        setIsLoading(false);
                                    });
                                },
                                className: 'btn btn-secondary text-sm px-3 py-1',
                                disabled: isLoading
                            },
                                React.createElement('i', { className: `fas fa-sync-alt ${isLoading ? 'animate-spin' : ''}` }),
                                ' Refresh'
                            )
                        )
                    ),
                    React.createElement('div', { className: 'tabs mb-4' },
                        ...categories.map(category =>
                            React.createElement('button', {
                                key: category.id,
                                className: `tab ${selectedCategory === category.id ? 'active' : ''}`,
                                onClick: () => setSelectedCategory(category.id),
                                title: category.tooltip
                            },
                                React.createElement('i', { className: `fas fa-${category.icon} mr-2` }),
                                category.label,
                                category.tooltip && React.createElement('div', { className: 'tooltip-content' }, category.tooltip)
                            )
                        )
                    ),
                    React.createElement('div', { className: 'flex justify-between items-center mb-4 text-xs' },
                        React.createElement('div', { className: 'flex items-center gap-4 text-gray-500' },
                            React.createElement('div', { className: 'flex items-center gap-1' },
                                React.createElement('div', { className: 'w-2 h-2 bg-green-500 rounded-full pulse-dot' }),
                                React.createElement('span', null, 'Live Data via Yahoo Finance API')
                            ),
                            lastUpdated && React.createElement('span', null, `Last updated: ${lastUpdated.toLocaleTimeString()}`)
                        ),
                        React.createElement('div', { className: 'flex items-center gap-2' },
                            React.createElement('span', { className: 'text-gray-500' }, `${refreshCount} updates`),
                            isAutoRefresh && React.createElement('span', { className: 'text-green-600' }, '• Auto-refresh ON')
                        )
                    ),
                    selectedCategory === 'custom' && React.createElement(StockSearch),
                    isLoading && refreshCount === 0 ?
                        React.createElement('div', { className: 'flex justify-center items-center py-12' },
                            React.createElement('div', { className: 'text-center' },
                                React.createElement('div', { className: 'loading-spinner mb-2' }),
                                React.createElement('p', { className: 'text-gray-600' }, 'Loading market data...')
                            )
                        ) :
                        React.createElement('div', { className: 'market-grid' },
                            ...getTickersForCategory(selectedCategory).map(ticker =>
                                React.createElement(StockCard, {
                                    key: ticker.symbol,
                                    ticker,
                                    data: marketData[ticker.symbol]
                                })
                            ).filter(Boolean)
                        )
                ),
                React.createElement('div', { className: 'card p-6' },
                    React.createElement('h4', { className: 'font-semibold text-gray-800 mb-3 flex items-center gap-2' },
                        React.createElement('i', { className: 'fas fa-lightbulb text-yellow-500' }),
                        'Investment Tips & Information'
                    ),
                    React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                        React.createElement('div', { className: 'space-y-2 text-sm text-gray-600' },
                            React.createElement('p', { className: 'flex items-center gap-2' },
                                React.createElement('i', { className: 'fas fa-chart-line text-blue-500' }),
                                'ETFs like SPY and VTI provide instant diversification across hundreds of stocks'
                            ),
                            React.createElement('p', { className: 'flex items-center gap-2' },
                                React.createElement('i', { className: 'fas fa-dollar-sign text-green-500' }),
                                'Consider dollar-cost averaging into broad market index funds for long-term growth'
                            ),
                            React.createElement('p', { className: 'flex items-center gap-2' },
                                React.createElement('i', { className: 'fas fa-chart-area text-purple-500' }),
                                'Monitor the VIX (volatility index) to understand market sentiment and fear levels'
                            )
                        ),
                        React.createElement('div', { className: 'space-y-2 text-sm text-gray-600' },
                            React.createElement('p', { className: 'flex items-center gap-2' },
                                React.createElement('i', { className: 'fas fa-sync-alt text-blue-500' }),
                                'Real-time data updates every second when viewing this page'
                            ),
                            React.createElement('p', { className: 'flex items-center gap-2' },
                                React.createElement('i', { className: 'fas fa-database text-gray-500' }),
                                'All market data is cached locally for better performance'
                            ),
                            React.createElement('p', { className: 'flex items-center gap-2' },
                                React.createElement('i', { className: 'fas fa-search text-indigo-500' }),
                                'Use the Custom Search tab to track any stock you want'
                            )
                        )
                    )
                )
            );
        }

        function Settings() {
            const { config, resetConfig } = useConfig();
            const [showConfirm, setShowConfirm] = useState(false);

            const handleReset = () => {
                if (showConfirm) {
                    resetConfig();
                    setShowConfirm(false);
                } else {
                    setShowConfirm(true);
                }
            };

            const currencySymbol = SUPPORTED_CURRENCIES.find(c => c.value === config.currency)?.symbol || '$';

            return React.createElement('div', { className: 'fade-in' },
                React.createElement('div', { className: 'card p-6' },
                    React.createElement('h3', { className: 'text-lg font-semibold mb-6' }, 'Personal Information'),
                    React.createElement('div', { className: 'form-grid' },
                        React.createElement(InputField, {
                            label: 'Current Age',
                            field: 'currentAge',
                            suffix: 'years',
                            min: 18,
                            max: 100
                        }),
                        React.createElement(InputField, {
                            label: 'Retirement Age',
                            field: 'retirementAge',
                            suffix: 'years',
                            min: 18,
                            max: 100
                        }),
                        React.createElement(SelectField, {
                            label: 'Currency',
                            field: 'currency',
                            options: SUPPORTED_CURRENCIES,
                            tooltip: 'Select your preferred currency. Values will be automatically converted when changed.'
                        })
                    )
                ),
                React.createElement('div', { className: 'card p-6' },
                    React.createElement('h3', { className: 'text-lg font-semibold mb-6' }, 'Financial Details'),
                    React.createElement('div', { className: 'form-grid' },
                        React.createElement(InputField, {
                            label: 'Current Savings',
                            field: 'currentSavings',
                            prefix: currencySymbol,
                            min: 0
                        }),
                        React.createElement(InputField, {
                            label: 'Monthly Contribution',
                            field: 'monthlySavings',
                            prefix: currencySymbol,
                            min: 0
                        }),
                        React.createElement(InputField, {
                            label: 'Expected Annual Return',
                            field: 'annualReturn',
                            suffix: '%',
                            min: 0,
                            max: 30,
                            step: 0.5,
                            tooltip: 'S&P 500 historical average is ~10%. A conservative estimate is 5-7% after inflation.'
                        }),
                        React.createElement(InputField, {
                            label: 'Monthly Expenses',
                            field: 'monthlyExpenses',
                            prefix: currencySymbol,
                            min: 0
                        }),
                        React.createElement(InputField, {
                            label: 'Safe Withdrawal Rate',
                            field: 'safeWithdrawalRate',
                            suffix: '%',
                            min: 1,
                            max: 10,
                            step: 0.1,
                            tooltip: 'The 4% rule is traditional, but 3-3.5% is more conservative for early retirement.'
                        }),
                        React.createElement(InputField, {
                            label: 'Inflation Rate',
                            field: 'inflationRate',
                            suffix: '%',
                            min: 0,
                            max: 10,
                            step: 0.1,
                            tooltip: 'Historical US inflation average is around 2-3%.'
                        })
                    )
                ),
                React.createElement('div', { className: 'gradient-border' },
                    React.createElement('div', null,
                        React.createElement('h3', { className: 'text-lg font-semibold mb-4 text-danger' }, 'Reset Settings'),
                        React.createElement('p', { className: 'text-gray-600 mb-4' },
                            'This will reset all your settings to default values. This action cannot be undone.'
                        ),
                        showConfirm ?
                            React.createElement('div', { className: 'flex gap-4' },
                                React.createElement('button', {
                                    onClick: handleReset,
                                    className: 'btn text-white px-6 py-2 rounded-lg font-medium bg-red-500 hover:bg-red-600'
                                }, 'Yes, Reset All'),
                                React.createElement('button', {
                                    onClick: () => setShowConfirm(false),
                                    className: 'btn btn-secondary'
                                }, 'Cancel')
                            ) :
                            React.createElement('button', {
                                onClick: handleReset,
                                className: 'btn text-white px-6 py-2 rounded-lg font-medium bg-red-500 hover:bg-red-600'
                            }, 'Reset All Settings')
                    )
                )
            );
        }

        function MainApp() {
            // Load saved tab from localStorage
            const [activeTab, setActiveTab] = useState(() => {
                const saved = localStorage.getItem('activeTab');
                return saved || 'dashboard';
            });

            const [notification, setNotification] = useState(null);
            const { config } = useConfig();
            const prevCurrency = useRef(config.currency);

            // Save active tab to localStorage whenever it changes
            useEffect(() => {
                localStorage.setItem('activeTab', activeTab);
                localStorage.setItem('lastActiveTab', activeTab);

                // Update page title based on active tab
                const tabNames = {
                    dashboard: 'Dashboard',
                    calculator: 'Calculator',
                    simulation: 'Simulation',
                    guide: 'Guides',
                    market: 'Market Data',
                    settings: 'Settings'
                };
                document.title = `Financial Atlas - ${tabNames[activeTab] || 'Your Financial Independence & Retirement Planner'}`;
            }, [activeTab]);

            useEffect(() => {
                if (prevCurrency.current !== config.currency && prevCurrency.current) {
                    setNotification({
                        message: `Currency changed to ${config.currency}. Values have been automatically converted.`,
                        type: 'success'
                    });
                    setTimeout(() => setNotification(null), 4000);
                }
                prevCurrency.current = config.currency;
            }, [config.currency]);

            const tabs = [
                { id: 'dashboard', label: 'Dashboard', icon: 'home' },
                { id: 'compound', label: 'Compound Interest', icon: 'chart-line' },
                { id: 'fire', label: 'FIRE Calculator', icon: 'fire' },
                { id: 'monte-carlo', label: 'Monte Carlo', icon: 'dice' },
                { id: 'market', label: 'Market Data', icon: 'chart-area' },
                { id: 'guide', label: 'Guides', icon: 'book-open' },
                { id: 'settings', label: 'Settings', icon: 'cog' }
            ];

            const renderContent = () => {
                switch (activeTab) {
                    case 'dashboard': return React.createElement(Dashboard);
                    case 'compound': return React.createElement(CompoundInterestCalculator);
                    case 'fire': return React.createElement(FIRECalculator);
                    case 'monte-carlo': return React.createElement(MonteCarloSimulator);
                    case 'market': return React.createElement(MarketData);
                    case 'guide': return React.createElement(Guide);
                    case 'settings': return React.createElement(Settings);
                    default: return React.createElement(Dashboard);
                }
            };

            return React.createElement('div', { className: 'min-h-screen bg-gray-50 relative' },
                React.createElement(Header),
                notification && React.createElement('div', {
                    className: `fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg border ${
                        notification.type === 'success'
                            ? 'bg-green-50 border-green-200 text-green-800'
                            : 'bg-blue-50 border-blue-200 text-blue-800'
                    } slide-in`
                },
                    React.createElement('div', { className: 'flex items-center gap-2' },
                        React.createElement('i', { className: 'fas fa-check-circle' }),
                        React.createElement('span', null, notification.message)
                    )
                ),
                React.createElement('main', { className: 'container py-8' },
                    React.createElement(TabNavigation, { activeTab, setActiveTab, tabs }),
                    renderContent()
                )
            );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            React.createElement(ConfigProvider, null,
                React.createElement(MainApp)
            )
        );
    </script>
</body>
</html>
